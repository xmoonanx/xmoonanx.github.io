---
title: "[CA] Chapter 10: Processor(5-3): Hazard"

categories: [CS, Computer Architecture, CA, Assembly language]
tags:
  - [CS, c, cpp, Computer Architecture, CA, Assembly language, binary code]
toc: true
toc_sticky: true

date: 2025-05-27
last_modified_at: 2025-05-27
---
âš™ **Computer Architecture ê³µë¶€**

## Data Hazard
---
ğŸ“š**<span style="color: #008000">Data Hazard</span>**: íŒŒì´í”„ë¼ì¸ì—ì„œ ì‹¤í–‰ë˜ëŠ” ëª…ë ¹ì–´ë“¤ ì‚¬ì´ì— **ë°ì´í„° ì˜ì¡´ì„±ì´ ìˆì„ ë•Œ ë°œìƒí•˜ëŠ” ë¬¸ì œ**
*  **ëª…ë ¹ì–´ì˜ ê²°ê³¼ê°€ ë‹¤ìŒ ëª…ë ¹ì–´ì˜ ì…ë ¥**ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ”ë°, ì•„ì§ ê²°ê³¼ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì„ ë•Œ ë°œìƒ

#### ì˜ˆì‹œ ì‹œë‚˜ë¦¬ì˜¤ 
![alt text](../assets/img/Architecture/hazard.png)

**ì„¤ì •**  
* `register $2`ì˜ ì´ˆê¸°ê°’: `10`
* **Instructions**:
  1. `sub $2, $1, $3` - $2ì— ê²°ê³¼ ì €ì¥ (10 â†’ -20)
  2. `and $12, $2, $5` - $2 ê°’ì„ ì½ìŒ
  3. `or $13, $6, $2` - $2 ê°’ì„ ì½ìŒ
  4. `add $14, $2, $2` - $2 ê°’ì„ ë‘ ë²ˆ ì½ìŒ
  5. `sw $15, 100($2)` - $2 ê°’ì„ ì£¼ì†Œë¡œ ì‚¬ìš©

##### ì‹œë‚˜ë¦¬ì˜¤ 1: sub $2, $1, $3
* **CC5**ì—ì„œ WB ë‹¨ê³„ë¥¼ í†µí•´ `$2`ì— -20ì„ ê¸°ë¡
* CC1~CC4ê¹Œì§€ëŠ” `$2` = 10 ìœ ì§€
* CC5ë¶€í„° `$2` = -20ìœ¼ë¡œ ë³€ê²½

##### ì‹œë‚˜ë¦¬ì˜¤ 2: and $12, $2, $5 (ë°ì´í„° í•´ì €ë“œ ë°œìƒ)
* CC3ì—ì„œ ID ë‹¨ê³„ì—ì„œ `$2` ê°’ì„ ì½ì–´ì•¼ í•¨
* í•˜ì§€ë§Œ ì´ë•Œ `$2`ëŠ” ì•„ì§ 10 (êµ¬ê°’)
* ì‹¤ì œë¡œ í•„ìš”í•œ ê°’ì€ -20 (ì‹ ê°’)
* **í•´ì €ë“œ ë°œìƒ!**

##### ì‹œë‚˜ë¦¬ì˜¤ 3: or $13, $6, $2 (ë°ì´í„° í•´ì €ë“œ ë°œìƒ)
* CC4ì—ì„œ ID ë‹¨ê³„ì—ì„œ `$2` ê°’ì„ ì½ì–´ì•¼ í•¨
* ì—¬ì „íˆ `$2`ëŠ” 10 (êµ¬ê°’)
* **í•´ì €ë“œ ë°œìƒ!**

##### ì‹œë‚˜ë¦¬ì˜¤ 4: add $14, $2, $2 (í•´ì €ë“œ ì—†ìŒ)
* CC5ì—ì„œ ID ë‹¨ê³„ì—ì„œ `$2` ê°’ì„ ì½ìŒ
* ì´ë•ŒëŠ” ì •í™•íˆ CC5ì—ì„œ `$2`ì— -20ì´ ê¸°ë¡ë˜ëŠ” ì‹œì 
* ê°™ì€ í´ë¡ ì‚¬ì´í´ ë‚´ì—ì„œ ì•ë¶€ë¶„ì— ì“°ê³  ë’·ë¶€ë¶„ì— ì½ìœ¼ë¯€ë¡œ í•´ì €ë“œ ì—†ìŒ

{:.prompt-tip}
> Data Harzardë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²• ì¡´ì¬!
>

### Data Forwarding
---
ğŸ“š**<span style="color: #008000">Data Forwarding</span>**: **ë ˆì§€ìŠ¤í„° íŒŒì¼ì„ ê±°ì¹˜ì§€ ì•Šê³  ì§ì ‘ íŒŒì´í”„ë¼ì¸ ë‹¨ê³„ ê°„ì— ë°ì´í„°ë¥¼ ì „ë‹¬**í•˜ì—¬ ë°ì´í„° í•´ì €ë“œë¥¼ í•´ê²°í•˜ëŠ” í•˜ë“œì›¨ì–´ ê¸°ë²•
![alt text](../assets/img/Architecture/Data_Forwarding.png)

1. **í¬ì›Œë”© íƒ€ì´ë°**
* CC3ì—ì„œ `sub`: EX ë‹¨ê³„ì—ì„œ ALUê°€ -20 ê³„ì‚° ì™„ë£Œ
* CC4ì—ì„œ `and`: EX ë‹¨ê³„ì—ì„œ `$2` ê°’ì´ í•„ìš” â†’ **EX/MEM ë ˆì§€ìŠ¤í„°ì—ì„œ í¬ì›Œë”©**
* CC5ì—ì„œ `or`: EX ë‹¨ê³„ì—ì„œ `$2` ê°’ì´ í•„ìš” â†’ **MEM/WB ë ˆì§€ìŠ¤í„°ì—ì„œ í¬ì›Œë”©**

2. **í¬ì›Œë”© ê²½ë¡œ**
* **EX-to-EX í¬ì›Œë”©**: EX/MEM ë ˆì§€ìŠ¤í„° â†’ ALU ì…ë ¥
* **MEM-to-EX í¬ì›Œë”©**: MEM/WB ë ˆì§€ìŠ¤í„° â†’ ALU ì…ë ¥

#### Data Detection
---
ğŸ“š**<span style="color: #008000">Data Detection</span>**: ì–¸ì œ í¬ì›Œë”©ì´ í•„ìš”í•œì§€ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ í¬ì›Œë”© ê²½ë¡œë¥¼ í™œì„±í™”
![alt text](../assets/img/Architecture/Data_Detection.png)

* data harzar ê°ì§€ ì¡°ê±´
![alt text](../assets/img/Architecture/Data_Detection1.png)

##### 4 Hazard case
1. **<span style="color: #008000">EX/MEM.RegisterRd = ID/EX.RegisterRs</span>**
* 1ë²ˆì§¸ì™€ 2ë²ˆì§¸ ëª…ë ¹ì–´ ì‚¬ì´, 2ë²ˆì§¸ ëª…ë ¹ì–´ì˜ ì²« ë²ˆì§¸ ì†ŒìŠ¤
2. **<span style="color: #008000">EX/MEM.RegisterRd = ID/EX.RegisterRt</span>**
* 1ë²ˆì§¸ì™€ 2ë²ˆì§¸ ëª…ë ¹ì–´ ê°„, 2ë²ˆì§¸ ëª…ë ¹ì–´ì˜ ë‘ ë²ˆì§¸ ì†ŒìŠ¤
3. **<span style="color: #008000">MEM/WB.RegisterRd = ID/EX.RegisterRs</span>**
* 1ë²ˆì§¸ì™€ 3ë²ˆì§¸ ëª…ë ¹ì–´ ê°„, 3ë²ˆì§¸ ëª…ë ¹ì–´ì˜ ì²« ë²ˆì§¸ ì†ŒìŠ¤
4. **<span style="color: #008000">MEM/WB.RegisterRd = ID/EX.RegisterRt</span>**
* 1ë²ˆì§¸ì™€ 3ë²ˆì§¸ ëª…ë ¹ì–´ ê°„, 3ë²ˆì§¸ ëª…ë ¹ì–´ì˜ ë‘ ë²ˆì§¸ ì†ŒìŠ¤

#### Implementation of Data Forwarding
---
![alt text](../assets/img/Architecture/Dataforimple.png)

* **<span style="color: #008000">forwarding unit</span>**: 4ê°œì˜ ë ˆì§€ìŠ¤í„° ë²ˆí˜¸ë¥¼ ì…ë ¥ë°›ìŒ
  * **EX/MEM.RegisterRd**: 1ë‹¨ê³„ ì• ëª…ë ¹ì–´ì˜ ëª©ì ì§€ ë ˆì§€ìŠ¤í„°
  * **MEM/WB.RegisterRd**: 2ë‹¨ê³„ ì• ëª…ë ¹ì–´ì˜ ëª©ì ì§€ ë ˆì§€ìŠ¤í„°
  * **ID/EX.RegisterRs**: í˜„ì¬ ëª…ë ¹ì–´ì˜ ì²« ë²ˆì§¸ ì†ŒìŠ¤ ë ˆì§€ìŠ¤í„°
  * **ID/EX.RegisterRt**: í˜„ì¬ ëª…ë ¹ì–´ì˜ ë‘ ë²ˆì§¸ ì†ŒìŠ¤ ë ˆì§€ìŠ¤í„°

* **ë©€í‹°í”Œë ‰ì„œ**: ê° ALU ì…ë ¥ë§ˆë‹¤ 3ê°€ì§€ ì†ŒìŠ¤ ì¤‘ì—ì„œ ì„ íƒ
1. ë ˆì§€ìŠ¤í„° íŒŒì¼ ì¶œë ¥(ê¸°ë³¸ê°’)
2. EX/MEM ë ˆì§€ìŠ¤í„° (1ë‹¨ê³„ ì• ê²°ê³¼)
3. MEM/WB ë ˆì§€ìŠ¤í„° (2ë‹¨ê³„ ì• ê²°ê³¼)

* **2-bit signal**
  * `00`: í•´ì €ë“œ ì—†ìŒ â†’ ë ˆì§€ìŠ¤í„° íŒŒì¼ì—ì„œ ì½ê¸°
  * `10`: EX í•´ì €ë“œ â†’ EX/MEMì—ì„œ í¬ì›Œë”©
  * `01`: MEM í•´ì €ë“œ â†’ MEM/WBì—ì„œ í¬ì›Œë”©
![alt text](../assets/img/Architecture/2bitsig.png)

âœ…**ì‹¤ì œ ë™ì‘ ì˜ˆì‹œ:**  

```
add $1, $2, $3  # CC1
sub $4, $1, $5  # CC2
```

**CC4 ì‹œì ì—ì„œ:**  

* EX/MEM.RegisterRd = `$1` (add ëª…ë ¹ì–´)
* ID/EX.RegisterRs = `$1` (sub ëª…ë ¹ì–´)
* í¬ì›Œë”© ìœ ë‹› íŒë‹¨: **EX/MEM.RegisterRd == ID/EX.RegisterRs**
* ê²°ê³¼: ForwardA = `10`
* ë©€í‹°í”Œë ‰ì„œ: **EX/MEM ë ˆì§€ìŠ¤í„°ì˜ ê°’ì„ ALU ì²« ë²ˆì§¸ ì…ë ¥ìœ¼ë¡œ ì„ íƒ**