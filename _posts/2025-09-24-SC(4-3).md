---
title: "[Security] Secure Coding(4-3) - ì •ê·œì‹ í™œìš©(ì…ë ¥ê°’ í•„í„°ë§)"

categories: [Security, Secure Coding]
tags:
  - [Security, Cyberattacks, ë³´ì•ˆ, ì‹œíì–´ ì½”ë”©, ì •ê·œì‹, í•„í„°ë§]
toc: true
toc_sticky: true

date: 2025-09-24
last_modified_at: 2025-09-24
---
>ğŸ”’ ì‹œíì–´ ì½”ë”© ìˆ˜ì—… ì •ë¦¬

## ì…ë ¥ê°’ í•„í„° ë§Œë“¤ê¸°
ğŸ“š**<span style="color: #008000">í•„í„°(filter)</span>**: **í´ë¼ì´ì–¸íŠ¸ì˜ HTTP ìš”ì²­ê³¼ ì‘ë‹µì„ ê°€ë¡œì±„ì–´ íŠ¹ì • ì‘ì—…ì„ ìˆ˜í–‰**í•˜ëŠ” ì„œë¸”ë¦¿ ê¸°ë°˜ ì»´í¬ë„ŒíŠ¸

* ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë³´ì•ˆ, ë¡œê¹…, ë°ì´í„° ë³€í™˜ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ë•Œ ì‚¬ìš©

âœ…**ì£¼ìš” ì—­í• **:  
* ìš”ì²­/ì‘ë‹µ ë¡œê¹…
* ì¸ì¦(Authentication) & ê¶Œí•œ ê²€ì‚¬(Authorization)
* CORS ì²˜ë¦¬(ë‹¤ë¥¸ ë„ë©”ì¸ì˜ ìš”ì²­ í—ˆìš© ë˜ëŠ” ì°¨ë‹¨)
* ë°ì´í„° ê²€ì¦ & ë³€í™˜(ìš”ì²­ ë°ì´í„° ê°€ê³µ ë° ìœ íš¨ì„± ê²€ì‚¬)
* ì‘ë‹µë³€í™˜(JSON,XML ë“± íŠ¹ì •í˜•ì‹ìœ¼ë¡œ ë³€ê²½)
* ë³´ì•ˆê°•í™”(SQL Injection, XSS ë“±ì˜ ê³µê²© ë°©ì–´)

![alt text](../assets/img/SC/springfilter.png)
> Spring Boot Filter êµ¬ì¡°

---

### í•„í„° êµ¬í˜„ ë°©ë²•

#### **1. ê¸°ë³¸ í•„í„° í´ë˜ìŠ¤ êµ¬í˜„**

```java
public class CustomFilter implements Filter {
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // í•„í„° ì´ˆê¸°í™” (ì„œë²„ ì‹œì‘ ì‹œ 1íšŒ ì‹¤í–‰)
    }
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        System.out.println("Request URI: " + httpRequest.getRequestURI());
        
        // ë‹¤ìŒ í•„í„° ë˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì§„í–‰
        chain.doFilter(request, response);
    }
    
    @Override
    public void destroy() {
        // í•„í„° ì¢…ë£Œ (ì„œë²„ ì¢…ë£Œ ì‹œ 1íšŒ ì‹¤í–‰)
    }
}
```

* `init()`: í•„í„°ê°€ ìƒì„±ë  ë•Œ ë”± í•œ ë²ˆ ì‹¤í–‰ (ì´ˆê¸°í™” ì‘ì—…)
* `doFilter()`: ìš”ì²­ì´ ì˜¬ ë•Œë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” í•µì‹¬ ë¡œì§
* `destroy()`: í•„í„°ê°€ ì œê±°ë  ë•Œ ì‹¤í–‰ (ì •ë¦¬ ì‘ì—…)
* `chain.doFilter()`: ë§¤ìš° ì¤‘ìš”! ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ëŠ” ëª…ë ¹

#### **2. í•„í„°ë¥¼ Spring Bootì— ë“±ë¡**
* **(ë°©ë²• 1)** `@Component` ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš© - ìë™ ë“±ë¡

```java
@Component
public class CustomFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        System.out.println("Request Method: " + httpRequest.getMethod());
        
        chain.doFilter(request, response);
    }
}
```

* ì¥ì : ì½”ë“œê°€ ê°„ë‹¨í•¨
* ë‹¨ì : í•„í„° ìˆœì„œ ì§€ì • ë¶ˆê°€, URL íŒ¨í„´ ì„¸ë°€í•˜ê²Œ ì„¤ì • ë¶ˆê°€

* **(ë°©ë²• 2)** `FilterRegistrationBean` ì‚¬ìš©í•˜ì—¬ ìˆ˜ë™ ë“±ë¡(ìš°ì„ ìˆœìœ„ ì§€ì •ì´ í•„ìš”í•œ ê²½ìš°)

```java
@Configuration
public class FilterConfig {
    
    @Bean
    public FilterRegistrationBean<CustomFilter> loggingFilter() {
        FilterRegistrationBean<CustomFilter> registrationBean = new FilterRegistrationBean<>();
        registrationBean.setFilter(new CustomFilter());
        registrationBean.addUrlPatterns("/api/*");  // íŠ¹ì • URL íŒ¨í„´ì—ë§Œ ì ìš©
        registrationBean.setOrder(1);  // í•„í„° ì‹¤í–‰ ìˆœì„œ ì§€ì • (ë‚®ì„ìˆ˜ë¡ ë¨¼ì € ì‹¤í–‰)
        return registrationBean;
    }
}
```

* ì¥ì : í•„í„° ì‹¤í–‰ ìˆœì„œ ì œì–´ ê°€ëŠ¥, URL íŒ¨í„´ ì„¸ë°€í•˜ê²Œ ì„¤ì • ê°€ëŠ¥, ì—¬ëŸ¬ í•„í„° ê´€ë¦¬ ìš©ì´

#### Spring Securityì™€ ê¸°ë³¸ í•„í„°

```java
@Configuration
public class DefaultSecurityConfig {
    
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                .anyRequest().authenticated()  // ëª¨ë“  ìš”ì²­ì€ ì¸ì¦ í•„ìš”
            )
            .formLogin()  // ê¸°ë³¸ ë¡œê·¸ì¸ í¼ í™œì„±í™”
            .httpBasic(); // HTTP Basic ì¸ì¦ í™œì„±í™”
            
        return http.build();
    }
}
```

1. `.authorizeHttpRequests()`: ì–´ë–¤ ìš”ì²­ì— ì¸ì¦ì´ í•„ìš”í•œì§€ ì„¤ì •
2. `.formLogin()`: ë¡œê·¸ì¸ í˜ì´ì§€ ìë™ ìƒì„±
3. `.httpBasic()`: HTTP Basic ì¸ì¦ ë°©ì‹ ì‚¬ìš©

---

### XSS ê³µê²©
ğŸ“š**<span style="color: #008000">XSS (Cross-Site Scripting)</span>**: ê²Œì‹œíŒì²˜ëŸ¼ ì…ë ¥ ë‚´ìš© ê·¸ëŒ€ë¡œ í‘œì¶œë˜ëŠ” ê³³ì— ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë„£ì–´, ì„œë¹„ìŠ¤ ì´ìš©ìì˜ ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ë˜ë„ë¡ í•˜ëŠ” ê³µê²©

ğŸ’¡**ì˜ˆì‹œ**:  
* ê²Œì‹œíŒì— ê¸€ì„ ì“¸ ë•Œ:
  * ê³µê²©ì: <script>alert('í•´í‚¹!');</script> ë¼ê³  ì…ë ¥
  * ê²°ê³¼: ê²Œì‹œê¸€ì„ ë³´ëŠ” ëª¨ë“  ì‚¬ëŒì˜ ë¸Œë¼ìš°ì €ì—ì„œ ê²½ê³ ì°½ì´ ëœ¸! ğŸ˜±

```
ì‹¤ì œ í”¼í•´ ì‚¬ë¡€:
âŒ ì¿ í‚¤/ì„¸ì…˜ íƒˆì·¨ â†’ ê³„ì • ë„ìš©
âŒ ì‚¬ìš©ì ì •ë³´ ìˆ˜ì§‘
âŒ ì•…ì„± ì‚¬ì´íŠ¸ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
âŒ í‚¤ë¡œê¹… (ì…ë ¥ ë‚´ìš© í›”ì¹˜ê¸°)
âŒ ê°€ì§œ ë¡œê·¸ì¸ í˜ì´ì§€ í‘œì‹œ
```

* **ğŸ›¡ï¸ XSS ë°©ì–´ ì „ëµ**
* ì‚¬ìš©ì ì…ë ¥ê°’ì—ì„œ ìœ„í—˜í•œ íŒ¨í„´ì˜ ë¬¸ìì—´ì„ í•„í„°ë§
* SpringBootì˜ ServletFilterì™€ HttpServletRequestWrapperë¥¼ ì´ìš©í•˜ì—¬ ëª¨ë“  ìš”ì²­ì˜ ì…ë ¥ê°’ì„ ê°€ë¡œì±”
* ì…ë ¥ê°’ì˜ ë‚´ìš©ì„ ì •ê·œì‹ìœ¼ë¡œ íŒ¨í„´ì„ í™•ì¸í•˜ì—¬ í•„í„°ë§ ì²˜ë¦¬

![alt text](../assets/img/SC/defendXSS.png)

#### XSS í•„í„° êµ¬í˜„
1. **XSSFilter ë§Œë“¤ê¸°**

```java
@Component
public class p043_XSSFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        
        // 1. ì¼ë°˜ Requestë¥¼ HttpServletRequestë¡œ ë³€í™˜
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        
        // 2. ğŸ”‘ í•µì‹¬: Requestë¥¼ XSSRequestWrapperë¡œ ê°ì‹¸ê¸°
        chain.doFilter(new p043_XSSRequestWrapper(httpRequest), response);
        
        // ì´ì œ Controllerì—ì„œ ë°›ëŠ” ëª¨ë“  íŒŒë¼ë¯¸í„°ëŠ” 
        // XSSRequestWrapperë¥¼ ê±°ì³ì„œ ìë™ìœ¼ë¡œ í•„í„°ë§ë¨
    }
}
```

2. **XSSRequestWrapper ë§Œë“¤ê¸°**

```java
public class p043_XSSRequestWrapper extends HttpServletRequestWrapper {
    
    public p043_XSSRequestWrapper(HttpServletRequest request) {
        super(request);
    }
    
    // 1. ë‹¨ì¼ íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¬ ë•Œ
    @Override
    public String getParameter(String name) {
        String value = super.getParameter(name);
        return (value != null) ? sanitize(value) : null;
    }
    
    // 2. ì—¬ëŸ¬ íŒŒë¼ë¯¸í„° ê°’ ê°€ì ¸ì˜¬ ë•Œ (checkbox ë“±)
    @Override
    public String[] getParameterValues(String name) {
        String[] values = super.getParameterValues(name);
        if (values != null){
          // ë°°ì—´ì˜ ëª¨ë“  ê°’ì„ sanitize ì²˜ë¦¬
          for (int i = 0; i < values.length; i++) {
              values[i] = sanitize(values[i]);
          }
        }
        return values;
    }
    
    // 3. í•µì‹¬ ë©”ì„œë“œ: ìœ„í—˜í•œ ë¬¸ìì—´ ì œê±°
    private String sanitize(String input) {
        if (input == null) return null;
        
        String clean = input;
        
        // (1) <script> íƒœê·¸ ì œê±°
        clean = clean.replaceAll("(?i)<script.*?>.*?</script>", "");
        
        // (2) onclick, onerror ë“± ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì œê±°
        clean = clean.replaceAll("(?i)on\\w+\\s*=\\s*[\"'][^\"']*[\"']", "");
        
        // (3) javascript: í”„ë¡œí† ì½œ ì œê±°
        clean = clean.replaceAll("(?i)javascript:", "");
        
        return clean;
    }
}
```

---

## LAB1 - ì†ŒìŠ¤ì½”ë“œì˜ XSS ì·¨ì•½ì  í™•ì¸

1. í™˜ê²½ êµ¬ì¶•í•œ LABì„ ì‹¤í–‰ì‹œì¼œ í¬ë¡¬ìœ¼ë¡œ ë¡œê·¸ì¸
2. ê²Œì‹œíŒ ë©”ë‰´ ì§„ì…
3. 'ì“°ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²Œì‹œê¸€ ì‘ì„±
4. ì œëª© ë¶€ë¶„ì— ì•„ë˜ì™€ ê°™ì´ ì…ë ¥
`ì•ˆë…•í•˜ì„¸ìš”<script>alert('XSS!!');</script>`

5. í™”ë©´ ì•„ë˜ë¡œ ë‚´ë ¤ê°€ 'í™•ì¸' ë²„íŠ¼
6. ê²Œì‹œíŒ ëª©ë¡ í™”ë©´ì—ì„œ í•´ë‹¹ ê²Œì‹œê¸€ ì œëª©ì— ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš©ì´ ë³´ì—¬ì§
7. í•´ë‹¹ ê²Œì‹œê¸€ì„ í´ë¦­í•˜ë©´ ìŠ¤í¬ë¦½íŠ¸ê°€ ë™ì‘í•˜ì—¬ í™”ë©´ì—
ê²½ê³ ì°½ì´ ë‚˜íƒ€ë‚¨

{:.prompt-warning}
> XSS ì·¨ì•½ì  ìˆëŠ” ê²ƒì´ í™•ì¸ë¨
>

