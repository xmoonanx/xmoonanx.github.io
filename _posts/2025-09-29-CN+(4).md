---
title: "[ğŸŒCN] ICMP - Internet Control Message Protocol"

categories: [CS, Internet Protocol]
tags:
  - [CS, Internet Protocol, Computer Networking, Network layer, ICMP, Error Reporting, Ping, Traceroute, PMTU]
toc: true
toc_sticky: true

date: 2025-09-29
last_modified_at: 2025-09-29
---
>ğŸŒ Internet Protocol ì „ê³µ ìˆ˜ì—… ì •ë¦¬

*IPëŠ” Best Effort ì„œë¹„ìŠ¤ë¡œ íŒ¨í‚· ì†ì‹¤ì´ë‚˜ ì˜¤ë¥˜ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ë ‡ë‹¤ë©´ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œë“¤ì„ ì–´ë–»ê²Œ ì§„ë‹¨í•  ìˆ˜ ìˆì„ê¹Œ? ICMPëŠ” IPì˜ ë³´ì¡° í”„ë¡œí† ì½œë¡œ, ì—ëŸ¬ ë¦¬í¬íŒ…ê³¼ ë„¤íŠ¸ì›Œí¬ ì§„ë‹¨ì„ ë‹´ë‹¹í•œë‹¤.*

-----

## **ICMPì˜ í•„ìš”ì„±**

### Error/Status Reportingì˜ ì¤‘ìš”ì„±

ğŸ“š**<span style="color: #008000">Silent Failure Problem</span>**: IPëŠ” Best Effort ì„œë¹„ìŠ¤ë¡œ ì—ëŸ¬ ë°œìƒ ì‹œ ì•Œë¦¼ ì—†ì´ íŒ¨í‚·ì„ ì¡°ìš©íˆ ë²„ë¦´ ìˆ˜ ìˆìŒ â†’ ì§„ë‹¨ì´ ë§¤ìš° ì–´ë ¤ì›€!

**ë¼ìš°í„°ê°€ ì§ë©´í•˜ëŠ” ì—ëŸ¬ ìƒí™©:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ ë¼ìš°í„°ê°€ íŒ¨í‚·ì„ ì–´ë””ë¡œ í¬ì›Œë”©í• ì§€ ëª¨ë¦„            â”‚
â”‚ âŒ TTL(Hop count)ì´ ë§Œë£Œë¨                           â”‚
â”‚ âŒ íŒ¨í‚·ì´ ë§í¬ì˜ MTUë³´ë‹¤ ë„ˆë¬´ í¼                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì™œ ì—ëŸ¬ ë³´ê³ ê°€ í•„ìš”í•œê°€?**

* âœ… IPëŠ” Best Effort â†’ ì—ëŸ¬ ì•Œë¦¼ ì˜ë¬´ ì—†ìŒ
* âŒ ê·¸ëŸ¬ë‚˜ Silent FailureëŠ” ë””ë²„ê¹…ì´ ë¶ˆê°€ëŠ¥!
* âœ… **í•´ê²°ì±…**: ICMPë¡œ ì—ëŸ¬ ìƒí™© ì „ë‹¬

{:.prompt-warning}
> **Best Effortì˜ ì˜ë¯¸**: "Never having to say you're sorry" - í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” ì—ëŸ¬ ë³´ê³ ê°€ í•„ìˆ˜ì !

-----

## **ICMP ê°œìš”**

### ICMPë€?

ğŸ“š**<span style="color: #008000">ICMP (Internet Control Message Protocol)</span>**: IPë¥¼ ë³´ì¡°í•˜ëŠ” í”„ë¡œí† ì½œë¡œ ì—ëŸ¬ ë¦¬í¬íŒ…ê³¼ ê°„ë‹¨í•œ ì¿¼ë¦¬ ê¸°ëŠ¥ì„ ì œê³µ

**IP ë³´ì¡° í”„ë¡œí† ì½œ êµ¬ì¡°:**

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         Routing Protocols           â”‚
        â”‚  RIP    OSPF    BGP    PIM          â”‚  â† ë¼ìš°íŒ… í…Œì´ë¸” êµ¬ì„±
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       Control Protocols             â”‚
        â”‚     ICMP           IGMP             â”‚  â† ì œì–´ ë©”ì‹œì§€
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              IP                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ICMPì˜ ê³„ì¸µì  ìœ„ì¹˜

**TCP/IP Stackì—ì„œì˜ ìœ„ì¹˜:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Application (Telnet, FTP, HTTP...)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Transport (TCP, UDP)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Network (IP)     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                   â”‚  ICMP   â”‚ â—„â”€â”€â”€â”€  IP ìœ„ì—ì„œ ë™ì‘í•˜ì§€ë§Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜    IPì˜ ì¼ë¶€ë¡œ ê°„ì£¼ë¨!
â”‚  Data Link (Ethernet, WiFi...)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ íŠ¹ì§•:**
* **Runs on top of IP**: TCP/UDPì™€ ê°™ì€ ë ˆë²¨
* **Integral part of IP**: Transportê°€ ì•„ë‹Œ IPì˜ í•„ìˆ˜ êµ¬ì„± ìš”ì†Œ
* **Protocol Field = 1**: IP í—¤ë”ì—ì„œ ICMP ì‹ë³„

-----

## **ICMP ë©”ì‹œì§€ êµ¬ì¡°**

### ICMP í—¤ë” í¬ë§·

```
bit # 0       7 8      15 16    23 24                            31
â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Type â”‚  Code  â”‚       Checksum                                 â”‚
â”‚(1 byte)â”‚(1 byte)â”‚      (16 bits)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Rest of the header (4 bytes)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                     Data section                               â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í—¤ë” í•„ë“œ:**

| í•„ë“œ         | í¬ê¸°    | ì„¤ëª…                                       |
| :----------- | :------ | :----------------------------------------- |
| **Type**     | 1 byte  | ICMP ë©”ì‹œì§€ íƒ€ì…                           |
| **Code**     | 1 byte  | ICMP ë©”ì‹œì§€ ì„œë¸Œíƒ€ì…                       |
| **Checksum** | 2 bytes | ì „ì²´ ICMP ë©”ì‹œì§€ì— ëŒ€í•œ ì²´í¬ì„¬ (IPì™€ ìœ ì‚¬) |

**ìµœì†Œ í¬ê¸°**: 8 bytes (ì¶”ê°€ ë°ì´í„° ì—†ì„ ê²½ìš° 4 bytesëŠ” 0ìœ¼ë¡œ ì±„ì›€)

### ICMP ìº¡ìŠí™”

**IP Datagram ë‚´ë¶€ êµ¬ì¡°:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IP Header   â”‚         IP Payload                 â”‚
â”‚              â”‚      (ICMP Message)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ICMP Message ìƒì„¸:
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type â”‚ Code â”‚ Checksum â”‚    Data Section         â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

-----

## **ICMP ë©”ì‹œì§€ íƒ€ì…**

### Error-Reporting vs Query Messages

**ICMP ë©”ì‹œì§€ ë¶„ë¥˜:**

```
                    ICMP Messages
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                               â”‚
    Error-Reporting                   Query
         â”‚                               â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Type 3, 4,   â”‚              â”‚Type 8/0, 13/14  â”‚
  â”‚5, 11, 12    â”‚              â”‚17/18, 9/10      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ICMP íƒ€ì… ì „ì²´ ëª©ë¡

| Type | Code | Message                     | ë¶„ë¥˜  | ì„¤ëª…                          |
| :--- | :--- | :-------------------------- | :---- | :---------------------------- |
| 0    | 0    | Echo Reply                  | Query | Ping ì‘ë‹µ                     |
| 3    | 0-15 | **Destination Unreachable** | Error | ëª©ì ì§€ ë„ë‹¬ ë¶ˆê°€              |
| 4    | 0    | Source Quench               | Error | í˜¼ì¡ ì œì–´ (í˜„ì¬ ì‚¬ìš© ì•ˆ í•¨)   |
| 5    | 0-3  | Redirect                    | Error | ë¼ìš°íŒ… ê²½ë¡œ ë³€ê²½ ì•Œë¦¼         |
| 8    | 0    | Echo Request                | Query | Ping ìš”ì²­                     |
| 9    | 0    | Router Advertisement        | Query | ë¼ìš°í„° ì•Œë¦¼                   |
| 10   | 0    | Router Solicitation         | Query | ë¼ìš°í„° ìš”ì²­                   |
| 11   | 0, 1 | **Time Exceeded**           | Error | TTL ë§Œë£Œ ë˜ëŠ” ì¬ì¡°ë¦½ íƒ€ì„ì•„ì›ƒ |
| 12   | 0, 1 | Parameter Problem           | Error | IP í—¤ë” ì˜¤ë¥˜                  |
| 13   | 0    | Timestamp Request           | Query | ì‹œê°„ ì •ë³´ ìš”ì²­                |
| 14   | 0    | Timestamp Reply             | Query | ì‹œê°„ ì •ë³´ ì‘ë‹µ                |
| 17   | 0    | Address Mask Request        | Query | ì„œë¸Œë„· ë§ˆìŠ¤í¬ ìš”ì²­            |
| 18   | 0    | Address Mask Reply          | Query | ì„œë¸Œë„· ë§ˆìŠ¤í¬ ì‘ë‹µ            |

-----

## **ICMP Error Messages**

### Error ë©”ì‹œì§€ì˜ ë™ì‘ ì›ë¦¬

**ì—ëŸ¬ ë°œìƒ ì‹œ íë¦„:**

```
Host A                Router                    Host B
  â”‚                      â”‚                         â”‚
  â”œâ”€â”€â”€â”€ IP Datagram â”€â”€â”€â”€â–ºâ”‚                         â”‚
  â”‚                      â”‚ (ë¬¸ì œ ë°œìƒ: TTL=0,      â”‚
  â”‚                      â”‚  ëª©ì ì§€ unreachable ë“±) â”‚
  â”‚                      â”‚                         â”‚
  â”‚                      â”œâ”€ Drop Datagram          â”‚
  â”‚                      â”‚                         â”‚
  â”‚â—„â”€â”€ ICMP Error â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
  â”‚    Message           â”‚                         â”‚
```

### Error ë©”ì‹œì§€ ë°ì´í„° ì„¹ì…˜

ğŸ“š**<span style="color: #008000">Error Message Content</span>**: ì›ë³¸ íŒ¨í‚·ì˜ IP í—¤ë” + ì²« 8 bytes payloadë¥¼ í¬í•¨í•˜ì—¬ ì—ëŸ¬ ì›ì¸ ì¶”ì  ê°€ëŠ¥

**Error ë©”ì‹œì§€ êµ¬ì¡°:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IP Header   â”‚ ICMP Header  â”‚  IP Header   â”‚ 8 bytes payload â”‚
â”‚  (new)       â”‚              â”‚  (original)  â”‚  (original)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   ì—ëŸ¬ê°€ ë°œìƒí•œ ì›ë³¸ íŒ¨í‚· ì •ë³´
```

**ICMP Header:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type â”‚ Code â”‚ Checksum â”‚   Unused (0x00000000)  â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì™œ 8 bytes payload?**
* TCP/UDP í—¤ë”ì˜ Source Port, Destination Port í¬í•¨ (ê° 2 bytes)
* í˜¸ìŠ¤íŠ¸ê°€ ì–´ë–¤ ì†Œì¼“/ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ê´€ë ¨ëœ ì—ëŸ¬ì¸ì§€ ì‹ë³„ ê°€ëŠ¥

### ICMP Error ë°œìƒ ì œí•œ ì¡°ê±´

**ë‹¤ìŒ ê²½ìš°ì—ëŠ” ICMP Error ë©”ì‹œì§€ë¥¼ ìƒì„±í•˜ì§€ ì•ŠìŒ:**

```
âŒ No ICMP Error for:

1. ICMP ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ëŠ” datagram
   â†’ ë¬´í•œ ë£¨í”„ ë°©ì§€!

2. Fragmentê°€ ì²« ë²ˆì§¸ê°€ ì•„ë‹Œ datagram
   â†’ ì²« fragmentë§Œ ì—ëŸ¬ ë³´ê³ 

3. Broadcast/Multicast ì£¼ì†Œë¥¼ ê°€ì§„ datagram
   â†’ ë„¤íŠ¸ì›Œí¬ í­ì£¼ ë°©ì§€

4. íŠ¹ìˆ˜ ì£¼ì†Œ (127.0.0.0, 0.0.0.0)ë¥¼ ê°€ì§„ datagram

5. IP Checksum ì—ëŸ¬ê°€ ìˆëŠ” datagram
```

-----

## **ì£¼ìš” Error ë©”ì‹œì§€ ìƒì„¸**

### Type 3: Destination Unreachable

ğŸ“š**<span style="color: #008000">Destination Unreachable</span>**: IP datagramì´ ëª©ì ì§€ì— ì „ë‹¬ë˜ì§€ ëª»í•˜ê³  íê¸°ë˜ì—ˆìŒì„ ì•Œë¦¼

**Code ê°’ë³„ ì˜ë¯¸:**

| Code | ì„¤ëª…                                      | ìƒì„± ì£¼ì²´ |
| :--- | :---------------------------------------- | :-------- |
| 0    | Network is unreachable                    | Router    |
| 1    | Host is unreachable                       | Router    |
| 2    | **Protocol is unreachable**               | **Host**  |
| 3    | **Port is unreachable**                   | **Host**  |
| 4    | Fragmentation required but DF set         | Router    |
| 5    | Source routing not feasible               | Router    |
| 6    | Destination network unknown               | Router    |
| 7    | Destination host unknown                  | Router    |
| 8    | Source host isolated                      | Router    |
| 9    | Network administratively prohibited       | Router    |
| 10   | Host administratively prohibited          | Router    |
| 11   | Network unreachable for TOS               | Router    |
| 12   | Host unreachable for TOS                  | Router    |
| 13   | Communication administratively prohibited | Router    |
| 14   | Host precedence violation                 | Router    |
| 15   | Precedence cutoff in effect               | Router    |

{:.prompt-info}
> **ë¼ìš°í„° vs í˜¸ìŠ¤íŠ¸**: Code 2, 3ë§Œ í˜¸ìŠ¤íŠ¸ê°€ ìƒì„±, ë‚˜ë¨¸ì§€ëŠ” ë¼ìš°í„°ê°€ ìƒì„±!

### Code 3: Port Unreachable

**ë°œìƒ ì‹œë‚˜ë¦¬ì˜¤:**

```
Client                              Server
  â”‚                                    â”‚
  â”œâ”€â”€â”€ UDP to port 80 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                    â”‚ âŒ No process listening
  â”‚                                    â”‚    on port 80
  â”‚                                    â”‚
  â”‚â—„â”€â”€â”€â”€ ICMP Port Unreachable â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚      (Type=3, Code=3)              â”‚
```

**RFC 792 ê·œì •:**
> "ëª©ì ì§€ í˜¸ìŠ¤íŠ¸ì—ì„œ IP ëª¨ë“ˆì´ í”„ë¡œí† ì½œ ëª¨ë“ˆì´ë‚˜ í”„ë¡œì„¸ìŠ¤ í¬íŠ¸ê°€ activeí•˜ì§€ ì•Šì•„ datagramì„ ì „ë‹¬í•  ìˆ˜ ì—†ìœ¼ë©´, destination unreachable ë©”ì‹œì§€ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆë‹¤."

**ì‹¤ì œ ì˜ˆì‹œ:**

```bash
bsdi % tftp
tftp> connect svr4 8888
tftp> get temp.foo
Transfer timed out.

# tcpdump ì¶œë ¥:
bsdi.2924 > svr4.8888: udp 20
svr4 > bsdi: icmp: svr4 udp port 8888 unreachable
```

### Type 5: Redirect

ğŸ“š**<span style="color: #008000">ICMP Redirect</span>**: ë” ë‚˜ì€ ê²½ë¡œê°€ ìˆì„ ë•Œ í˜¸ìŠ¤íŠ¸ì˜ ë¼ìš°íŒ… í…Œì´ë¸”ì„ ì—…ë°ì´íŠ¸í•˜ë„ë¡ ì•Œë¦¼

**ë°œìƒ ìƒí™©:**

```
íŠ¹ìˆ˜í•œ ìƒí™©: ê°™ì€ ë„¤íŠ¸ì›Œí¬ì— ì—¬ëŸ¬ ë¼ìš°í„°ê°€ ìˆì„ ë•Œ

                        â”Œâ”€â”€â”€â”€â”
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”‚ R1 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚       â””â”€â”€â”€â”€â”˜         â”‚
                â”‚                      â”‚
        â”Œâ”€â”€â”€â”€â”  â”‚                      â”‚  Internet  â”Œâ”€â”€â”€â”€â”
        â”‚ S  â”‚â”€â”€â”¤                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ D  â”‚
        â””â”€â”€â”€â”€â”˜  â”‚       â”Œâ”€â”€â”€â”€â”         â”‚            â””â”€â”€â”€â”€â”˜
                â””â”€â”€â”€â”€â”€â”€â”€â”‚ R2 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â””â”€â”€â”€â”€â”˜

ë¬¸ì œ: Default Router = R1ì´ì§€ë§Œ, Dë¡œ ê°€ë ¤ë©´ R2ê°€ ë” ë¹ ë¦„!
```

**Redirect ë™ì‘:**

1. Sê°€ R1ìœ¼ë¡œ íŒ¨í‚· ì „ì†¡
2. R1ì´ R2ê°€ ë” ë‚˜ì€ ê²½ë¡œì„ì„ ë°œê²¬
3. R1ì´ Sì—ê²Œ **ICMP Redirect (Type=5)** ì „ì†¡
4. Sì˜ ë¼ìš°íŒ… í…Œì´ë¸” ì—…ë°ì´íŠ¸: D â†’ R2

**Code ê°’:**

| Code | ì„¤ëª…                                     |
| :--- | :--------------------------------------- |
| 0    | Redirect for network                     |
| 1    | Redirect for host                        |
| 2    | Redirect for type-of-service and network |
| 3    | Redirect for type-of-service and host    |

### Type 11: Time Exceeded

ğŸ“š**<span style="color: #008000">Time Exceeded</span>**: TTLì´ 0ì— ë„ë‹¬í•˜ê±°ë‚˜ Fragment ì¬ì¡°ë¦½ íƒ€ì„ì•„ì›ƒ ë°œìƒ

**Code ê°’:**

| Code | ì„¤ëª…                                    | ìš©ë„              |
| :--- | :-------------------------------------- | :---------------- |
| 0    | Time-to-live equals 0 during transit    | **Traceroute**    |
| 1    | Time-to-live equals 0 during reassembly | Fragment íƒ€ì„ì•„ì›ƒ |

**TTL ë™ì‘ ì˜ˆì‹œ:**

```
íŒ¨í‚· ê²½ë¡œ:
  Host A (TTL=64) â†’ R1 (TTL=63) â†’ R2 (TTL=62) â†’ ... â†’ Destination

TTL=0ì´ ë˜ë©´:
  Router â”€â”€â–º Drop Packet
         â”‚
         â””â”€â–º Send ICMP Time Exceeded to Source
```

**Wireshark ì˜ˆì‹œ:**

```
Internet Control Message Protocol
  Type: 11 (Time-to-live exceeded)
  Code: 0 (Time to live exceeded in transit)
  Checksum: 0xecbe [correct]
  Unused: 00000000

Internet Protocol Version 4, Src: 192.168.0.2, Dst: 192.168.1.2
User Datagram Protocol, Src Port: 33289, Dst Port: 44444
```

### Type 12: Parameter Problem

**ë°œìƒ ê²½ìš°:**

| Code | ì„¤ëª…                           |
| :--- | :----------------------------- |
| 0    | IP header bad (catchall error) |
| 1    | Required option missing        |

-----

## **ICMP Query Messages**

### Query ë©”ì‹œì§€ì˜ íŠ¹ì§•

**Query vs Error:**

```
Error Message:              Query Message:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ One-way  â”‚                â”‚ Request  â”‚
â”‚ (ì—ëŸ¬ í†µë³´)â”‚                â”‚   +      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚ Reply    â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Query ì¢…ë¥˜:**

```
                    Query Messages
                         â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                  â”‚                  â”‚
   Echo            Timestamp         Address Mask
 (Type 8/0)        (Type 13/14)      (Type 17/18)
      â”‚                  â”‚                  â”‚
   Router Solicitation/Advertisement
        (Type 10/9)
```

-----

## **Type 8/0: Echo Request/Reply (Ping)**

### Pingì˜ ë™ì‘ ì›ë¦¬

ğŸ“š**<span style="color: #008000">Ping</span>**: ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„± í…ŒìŠ¤íŠ¸ ë„êµ¬, ICMP Echo Request/Reply ì‚¬ìš©

**Ping ë™ì‘:**

```
Host A                              Router/Host B
  â”‚                                       â”‚
  â”œâ”€â”€â”€â”€â”€ ICMP Echo Request (Type=8) â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                       â”‚
  â”‚                                   Kernelì´
  â”‚                                   ì§ì ‘ ì²˜ë¦¬
  â”‚                                       â”‚
  â”‚â—„â”€â”€â”€â”€ ICMP Echo Reply (Type=0) â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                       â”‚
```

**í•µì‹¬ íŠ¹ì§•:**
* âœ… Kernelì—ì„œ ì§ì ‘ ì²˜ë¦¬ (Application Layer ë¶ˆí•„ìš”)
* âœ… ë§¤ìš° ë¹ ë¥¸ ì‘ë‹µ
* âœ… ë¼ìš°í„°ì™€ í˜¸ìŠ¤íŠ¸ ëª¨ë‘ ì‘ë‹µ ê°€ëŠ¥

**Echo Request/Reply í¬ë§·:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type â”‚ Code â”‚ Checksum â”‚ Identifier â”‚Sequence Numberâ”‚
â”‚ 8/0  â”‚  0   â”‚          â”‚  (2 bytes) â”‚   (2 bytes)  â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Optional Data (ê°€ë³€ ê¸¸ì´)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Identifier & Sequence Number:**
* **Identifier**: Ping í”„ë¡œì„¸ìŠ¤ ì‹ë³„
* **Sequence Number**: ê° ìš”ì²­/ì‘ë‹µ ìŒì„ ë§¤ì¹­

-----

## **Type 13/14: Timestamp Request/Reply**

### Timestamp ë©”ì‹œì§€

ğŸ“š**<span style="color: #008000">Timestamp</span>**: ì‹œìŠ¤í…œ ê°„ ì‹œê°„ ì •ë³´ êµí™˜ ë° Round-Trip Time ì¸¡ì •

**í¬ë§·:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Type   â”‚ Code â”‚ Checksum â”‚ Identifier â”‚Sequence Numberâ”‚
â”‚ 13 or 14 â”‚  0   â”‚          â”‚            â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         32-bit Originate Timestamp                       â”‚
â”‚         (ìš”ì²­ ì „ì†¡ ì‹œê°„)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         32-bit Receive Timestamp                         â”‚
â”‚         (ìš”ì²­ ìˆ˜ì‹  ì‹œê°„)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         32-bit Transmit Timestamp                        â”‚
â”‚         (ì‘ë‹µ ì „ì†¡ ì‹œê°„)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì‹œê°„ í˜•ì‹:**
* UTC (Universal Coordinated Time) ìì • ì´í›„ ê²½ê³¼ milliseconds
* 32-bit â†’ ì•½ 24ì‹œê°„ ì£¼ê¸°ë¡œ overflow

**ìš©ë„:**
* ì‹œìŠ¤í…œ ì‹œê³„ ë™ê¸°í™” (NTPì˜ ì „ì‹ )
* Round-Trip Time (RTT) ì¸¡ì •

-----

## **ë„¤íŠ¸ì›Œí¬ ê²½ë¡œ íƒìƒ‰**

### Path MTU Discovery

ğŸ“š**<span style="color: #008000">PMTU (Path MTU)</span>**: End-to-end ê²½ë¡œìƒì˜ ìµœì†Œ MTU

**ë¬¸ì œ ìƒí™©:**

```
Host A                Router C               Host B
MTU=1500   MTU=1500   MTU=1400   MTU=1300
   â”‚           â”‚          â”‚           â”‚
   â”œâ”€ 1500B â”€â”€â–ºâ”‚          â”‚           â”‚
   â”‚           â”œâ”€ 1500B â”€â–ºâ”‚           â”‚
   â”‚           â”‚          â”‚ âŒ Too big!â”‚
   â”‚           â”‚          â”‚           â”‚
```

**RFC 1191 í•´ê²° ë°©ë²•:**

```
Step 1: DF (Don't Fragment) ë¹„íŠ¸ ì„¤ì •í•˜ê³  ì „ì†¡

Step 2: MTU ì´ˆê³¼ ì‹œ ICMP ìˆ˜ì‹ 
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Type: 3 (Destination Unreachable)       â”‚
  â”‚ Code: 4 (Fragmentation needed but DF    â”‚
  â”‚          set)                            â”‚
  â”‚ MTU of next hop: 1400 â—„â”€â”€â”€ ì¤‘ìš”!        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: ë” ì‘ì€ MTUë¡œ ì¬ì „ì†¡

Step 4: ì„±ê³µí•  ë•Œê¹Œì§€ ë°˜ë³µ
```

**PMTU Discovery ê³¼ì •:**

```
Host A                                      Host E
  â”‚                                            â”‚
  â”œâ”€â”€â”€ Packet (MTU=1500, DF=1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º âŒ
  â”‚                                            â”‚
  â”‚â—„â”€â”€ ICMP: Use MTU=1400 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                            â”‚
  â”œâ”€â”€â”€ Packet (MTU=1400, DF=1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º âŒ
  â”‚                                            â”‚
  â”‚â—„â”€â”€ ICMP: Use MTU=1300 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                            â”‚
  â”œâ”€â”€â”€ Packet (MTU=1300, DF=1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º âœ…
  â”‚                                            â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€ Packet received â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```

**Wireshark ì˜ˆì‹œ:**

```
Internet Control Message Protocol
  Type: 3 (Destination unreachable)
  Code: 4 (Fragmentation needed)
  Checksum: 0x3147 [correct]
  Unused: 0000
  MTU of next hop: 1400 â—„â”€â”€â”€ ë‹¤ìŒì— ì‚¬ìš©í•  MTU!
```

-----

## **Traceroute**

### Traceroute ì›ë¦¬

ğŸ“š**<span style="color: #008000">Traceroute</span>**: íŒ¨í‚·ì´ ëª©ì ì§€ê¹Œì§€ ê±°ì¹˜ëŠ” ëª¨ë“  ë¼ìš°í„°ì˜ ê²½ë¡œë¥¼ ì¶”ì í•˜ëŠ” ë„êµ¬

**TTLì„ ì´ìš©í•œ ê²½ë¡œ íƒìƒ‰:**

```
TTLì˜ ë™ì‘:
  â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”
  â”‚ Src â”‚       â”‚ R1  â”‚       â”‚ R2  â”‚       â”‚ Dst â”‚
  â””â”€â”€â”¬â”€â”€â”˜       â””â”€â”€â”¬â”€â”€â”˜       â””â”€â”€â”¬â”€â”€â”˜       â””â”€â”€â”¬â”€â”€â”˜
     â”‚             â”‚             â”‚             â”‚
     â”œâ”€ TTL=1 â”€â”€â”€â”€â–ºâ”‚             â”‚             â”‚
     â”‚             â”œâ”€ TTL=0 âŒ   â”‚             â”‚
     â”‚â—„â”€ ICMP â”€â”€â”€â”€â”€â”¤             â”‚             â”‚
     â”‚   R1 ì‹ë³„   â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”œâ”€â”€â”€â”€ TTL=2 â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚
     â”‚             â”‚             â”œâ”€ TTL=0 âŒ   â”‚
     â”‚â—„â”€â”€â”€ ICMP â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
     â”‚      R2 ì‹ë³„â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”œâ”€â”€â”€â”€ TTL=3 â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚             â”‚             â”‚             â”‚ âœ… ë„ì°©
```

**Traceroute ì•Œê³ ë¦¬ì¦˜:**

1. **TTL=1ë¡œ íŒ¨í‚· ì „ì†¡** â†’ ì²« ë²ˆì§¸ ë¼ìš°í„°ì—ì„œ Time Exceeded ìˆ˜ì‹ 
2. **TTL=2ë¡œ íŒ¨í‚· ì „ì†¡** â†’ ë‘ ë²ˆì§¸ ë¼ìš°í„°ì—ì„œ Time Exceeded ìˆ˜ì‹ 
3. **TTL=në¡œ íŒ¨í‚· ì „ì†¡** â†’ ëª©ì ì§€ ë„ë‹¬ê¹Œì§€ ë°˜ë³µ

**ê° í™‰ì—ì„œ ë°›ëŠ” ì •ë³´:**
```
ICMP Time Exceeded ë©”ì‹œì§€:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Type: 11 (Time Exceeded)            â”‚
  â”‚ Code: 0 (TTL expired in transit)    â”‚
  â”‚ Source IP: ë¼ìš°í„°ì˜ IP ì£¼ì†Œ â—„â”€ ì¤‘ìš”! â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Traceroute ì‹¤í–‰ ì˜ˆì‹œ

**ëª…ë ¹ì–´:**

```bash
$ traceroute www.whitehouse.gov
```

**ì¶œë ¥ ê²°ê³¼:**

```
traceroute to www.whitehouse.gov (204.102.114.49), 30 hops max, 40 byte packets

 1  cory115-1-gw.EECS.Berkeley.EDU (128.32.48.1)
    0.829 ms  0.660 ms  0.565 ms

 2  cory-cr-1-1-soda-cr-1-2.EECS.Berkeley.EDU (169.229.59.233)
    0.953 ms  0.857 ms  0.727 ms

 3  soda-cr-1-1-soda-br-6-2.EECS.Berkeley.EDU (169.229.59.225)
    1.461 ms  1.260 ms  1.137 ms

 4  g3-8.inr-202-reccev.Berkeley.EDU (128.32.255.169)
    1.402 ms  1.298 ms  *  â—„â”€â”€â”€ Lost Reply (ë¼ìš°í„°ê°€ ICMP ì•ˆ ë³´ëƒ„)

 8  * * *  â—„â”€â”€â”€ ì´ ë¼ìš°í„°ëŠ” ICMPë¥¼ ë³´ë‚´ì§€ ì•Šë„ë¡ ì„¤ì •ë¨

12  a204-102-114-49.deploy.akamaitechnologies.com (204.102.114.49)
    18.137 ms  14.905 ms  19.730 ms  â—„â”€â”€â”€ Final Hop (ëª©ì ì§€ ë„ë‹¬!)
```

**ê° ì¤„ì˜ ì˜ë¯¸:**

```
Hop #  Hostname (IP Address)  RTT1  RTT2  RTT3
  â”‚         â”‚                  â”‚     â”‚     â”‚
  â”‚         â”‚                  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€ ì„¸ ë²ˆì˜ ì¸¡ì •ê°’
  â”‚         â””â”€ í•´ë‹¹ ë¼ìš°í„°ì˜ ì£¼ì†Œ
  â””â”€ í™‰ ì¹´ìš´íŠ¸ (TTL ê°’)
```

**íŠ¹ìˆ˜ í‘œì‹œ:**
* `*` : ì‘ë‹µ ì—†ìŒ (Timeout ë˜ëŠ” ICMP ì°¨ë‹¨)
* No PTR record: DNS ì—­ë°©í–¥ ì¡°íšŒ ì‹¤íŒ¨

-----

## **Ping & Traceroute Q&A**

### ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

**Q: Pingì€ ë¼ìš°í„°ì— ì˜í•´ í¬ì›Œë”©ë˜ë‚˜ìš”?**

A: âœ… **Yes!** ê·¸ë˜ì„œ ì¸í„°ë„· ì–´ë””ì—ë‚˜ pingì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
Client â”€â”€â–º Router 1 â”€â”€â–º Router 2 â”€â”€â–º Server
   â”‚                                    â”‚
   â””â”€â”€â”€â”€ Pingì€ ëª¨ë“  ë¼ìš°í„°ë¥¼ í†µê³¼ â”€â”€â”€â”€â”€â”€â”˜
```

**Q: ëª¨ë“  ì¥ë¹„ê°€ Pingì— ì‘ë‹µí•˜ë‚˜ìš”?**

A: âŒ **No!** ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ ë§ì€ ì¥ë¹„ê°€ ICMPë¥¼ ì°¨ë‹¨í•©ë‹ˆë‹¤.

```
ì°¨ë‹¨ ì´ìœ :
1. ë³´ì•ˆ: DoS ê³µê²© ë°©ì§€
2. ì •ì±…: ë„¤íŠ¸ì›Œí¬ êµ¬ì¡° ìˆ¨ê¹€
3. ì„±ëŠ¥: ICMP ì²˜ë¦¬ ë¶€ë‹´ ê°ì†Œ
```

**Q: ë¼ìš°í„°ê°€ ë‹¤ë¥¸ ì¥ë¹„ë¡œ ê°€ëŠ” Pingì„ í¬ì›Œë”©í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‚˜ìš”?**

A: âœ… **Yes!** ë¼ìš°í„°ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì • ê°€ëŠ¥:
* Ping ì‘ë‹µ ì•ˆ í•¨ (ìì‹ ì— ëŒ€í•œ)
* Ping í¬ì›Œë”© ì•ˆ í•¨ (ë‹¤ë¥¸ ì¥ë¹„ë¡œ ê°€ëŠ”)

-----

## **ICMPv6 (IPv6ìš© ICMP)**

### ICMPv4ì™€ì˜ ì°¨ì´ì 

ğŸ“š**<span style="color: #008000">ICMPv6</span>**: IPv6ìš©ìœ¼ë¡œ í™•ì¥ëœ ICMP, ARPì™€ IGMP ê¸°ëŠ¥ê¹Œì§€ í†µí•©

**ì£¼ìš” ë³€ê²½ ì‚¬í•­:**

```
ICMPv4 â†’ ICMPv6 ë³€í™”:

âœ… ìœ ì§€:
  - Error message (Destination Unreachable, Time Exceeded ë“±)
  - Query request/response (Echo, Timestamp ë“±)

âŒ ì œê±°:
  - ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë©”ì‹œì§€ íƒ€ì… ì‚­ì œ

â• ì¶”ê°€:
  - Neighbor Solicitation (NS) - ARP request ì—­í• 
  - Neighbor Advertisement (NA) - ARP response ì—­í• 
  - Packet Too Big (Type 2) - Fragmentation ì œê±°ë¡œ ìƒˆë¡œ ì¶”ê°€
  - Multicast Listener Discovery (MLD) - IGMP ì—­í• 
```

### ICMPv6 Neighbor Discovery

**NS (Neighbor Solicitation):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type=135 â”‚Code=0â”‚ Checksum â”‚      Reserved      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Target Address (128 bits)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**NA (Neighbor Advertisement):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type=136 â”‚Code=0â”‚ Checksum â”‚R â”‚S â”‚O â”‚ Reserved â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Target Address (128 bits)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Flags:**
* **R (Router)**: 1ì´ë©´ ë¼ìš°í„°ê°€ ì „ì†¡, 0ì´ë©´ í˜¸ìŠ¤íŠ¸
* **S (Solicited)**: 1ì´ë©´ NSì— ëŒ€í•œ ì‘ë‹µ
* **O (Override)**: 1ì´ë©´ ê¸°ì¡´ ìºì‹œ ì •ë³´ ì—…ë°ì´íŠ¸

### ICMPv6 ì£¼ìš” ì°¨ì´

**1. Fragmentation ë³€ê²½:**

```
IPv4: ë¼ìš°í„°ê°€ Fragment ê°€ëŠ¥
  â””â”€â–º Fragment ê´€ë ¨ ICMP ë©”ì‹œì§€

IPv6: Fragmentation ì—†ìŒ!
  â””â”€â–º Packet Too Big (Type 2) ë©”ì‹œì§€
      MTUë³´ë‹¤ í° íŒ¨í‚·ì€ ë¬´ì¡°ê±´ Drop + ICMP ì „ì†¡
```

**2. Multicast ì§€ì›:**

```
ICMPv6ëŠ” Multicastë„ ì§€ì›:
  - Neighbor Discoveryì— Multicast ì‚¬ìš©
  - Multicast Listener Discovery (MLD)
```

-----

## **ICMPì˜ ì‹¤ì „ í™œìš©**

### ë„¤íŠ¸ì›Œí¬ ì§„ë‹¨ ì›Œí¬í”Œë¡œìš°

**ë¬¸ì œ ì§„ë‹¨ ìˆœì„œ:**

```
1. Pingìœ¼ë¡œ ì—°ê²°ì„± í™•ì¸
   â”œâ”€â–º ì„±ê³µ â†’ ë„¤íŠ¸ì›Œí¬ ì •ìƒ
   â””â”€â–º ì‹¤íŒ¨ â†“

2. Tracerouteë¡œ ê²½ë¡œ í™•ì¸
   â”œâ”€â–º ì–´ë””ì„œ ëŠê¸°ëŠ”ì§€ í™•ì¸
   â””â”€â–º ë¬¸ì œ ë¼ìš°í„° ì‹ë³„ â†“

3. PMTU Discoveryë¡œ MTU ë¬¸ì œ í™•ì¸
   â””â”€â–º Fragmentation ì´ìŠˆ í•´ê²°

4. ICMP Error ë¡œê·¸ ë¶„ì„
   â””â”€â–º ê·¼ë³¸ ì›ì¸ íŒŒì•…
```

### ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

**ICMP ë‚¨ìš© ë°©ì§€:**

```
ê³µê²© ìœ í˜•:
1. ICMP Flood (Ping Flood)
   â””â”€â–º ëŒ€ëŸ‰ì˜ Echo Requestë¡œ ê³¼ë¶€í•˜

2. Smurf Attack
   â””â”€â–º Broadcast ì£¼ì†Œë¡œ Ping â†’ ì¦í­ ê³µê²©

3. ICMP Redirect ìŠ¤í‘¸í•‘
   â””â”€â–º ì•…ì˜ì ì¸ ê²½ë¡œ ë³€ê²½

ëŒ€ì‘:
âœ… Rate Limiting: ICMP ë©”ì‹œì§€ ì†ë„ ì œí•œ
âœ… Filtering: ë¶ˆí•„ìš”í•œ ICMP íƒ€ì… ì°¨ë‹¨
âœ… Validation: Source IP ê²€ì¦
```

-----

## **ì •ë¦¬**

### ICMPì˜ í•µì‹¬ ì—­í• 

| ê¸°ëŠ¥                | ì„¤ëª…                        | ëŒ€í‘œ ë©”ì‹œì§€      |
| :------------------ | :-------------------------- | :--------------- |
| **Error Reporting** | IP ì „ì†¡ ì¤‘ ë°œìƒí•œ ë¬¸ì œ ë³´ê³  | Type 3, 11, 12   |
| **Diagnostics**     | ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë° ê²½ë¡œ ì§„ë‹¨  | Ping, Traceroute |
| **Path Discovery**  | MTU ë° ê²½ë¡œ ì •ë³´ íƒìƒ‰       | PMTU Discovery   |
| **Control**         | ë¼ìš°íŒ… ìµœì í™” ë° ì œì–´       | Redirect         |

### ì£¼ìš” ICMP ë©”ì‹œì§€ ìš”ì•½

| Type | ì´ë¦„                    | ìš©ë„           | í•µì‹¬ í™œìš©              |
| :--- | :---------------------- | :------------- | :--------------------- |
| 0/8  | Echo Reply/Request      | ì—°ê²°ì„± í…ŒìŠ¤íŠ¸  | **Ping**               |
| 3    | Destination Unreachable | ì „ë‹¬ ì‹¤íŒ¨ ì•Œë¦¼ | ë””ë²„ê¹…                 |
| 5    | Redirect                | ê²½ë¡œ ìµœì í™”    | ë¼ìš°íŒ… í…Œì´ë¸” ì—…ë°ì´íŠ¸ |
| 11   | Time Exceeded           | TTL ë§Œë£Œ       | **Traceroute**         |

{:.prompt-tip}
> **ICMPì˜ í•µì‹¬**: IPì˜ Best Effortë¥¼ ë³´ì™„í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ë¥¼ ì§„ë‹¨ ê°€ëŠ¥í•˜ê³  ë””ë²„ê¹… ê°€ëŠ¥í•˜ê²Œ ë§Œë“œëŠ” í•„ìˆ˜ í”„ë¡œí† ì½œ!

**ICMP ì—†ì´ëŠ” ë¶ˆê°€ëŠ¥í•œ ê²ƒë“¤:**
* âŒ Pingìœ¼ë¡œ ì—°ê²° í™•ì¸
* âŒ Tracerouteë¡œ ê²½ë¡œ ì¶”ì 
* âŒ PMTU Discoveryë¡œ ìµœì  íŒ¨í‚· í¬ê¸° ê²°ì •
* âŒ ì—ëŸ¬ ë°œìƒ ì‹œ ì›ì¸ íŒŒì•…
