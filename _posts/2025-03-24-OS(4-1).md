---
title: "[OS] Operating System(4-1): Multicore Programming, Multithreading, Pthread"

categories: [CS, Operating System, OS]
tags:
  - [CS, OS, Operating System, Multicore, Multithreading, Pthread]
toc: true
toc_sticky: true

date: 2025-03-24
last_modified_at: 2025-03-24
---
>ğŸ€ ìš´ì˜ì²´ì œ ì „ê³µ ìˆ˜ì—… ì •ë¦¬

## Single and Multithreaded Processes
---
![alt text](../assets/img/OS/Multithreaded_Processes.png)
* **single threaded process:**
  * í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ì¡´ì¬
  * ëª¨ë“  ìì›ì„ ë‹¨ì¼ ìŠ¤ë ˆë“œê°€ ì‚¬ìš©
* **<span style="color: #008000">multithreaded process</span>:**
  * `code`, `data`, `files`ë¥¼ ê³µìœ 
  * `registers`, `PC`, `stack`: ìŠ¤ë ˆë“œë³„ ê³µìœ  ì˜ì—­

## Multithreaded Server Architecture
---
![alt text](../assets/img/OS/Multithreaded_Architecture.png)
**multithreaded Serverì˜ ì²˜ë¦¬ê³¼ì •:**
1. clientì˜ ìš”ì²­ ì ‘ìˆ˜
2. ìš”ì²­ ì²˜ë¦¬ë¥¼ ìœ„í•œ ìƒˆ ìŠ¤ë ˆë“œ ìƒì„±
3. ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ê¸° ìœ„í•´ ë¦¬ìŠ¤ë‹ ìƒíƒœë¡œ ë³µê·€

#### Benefit of Multithreading
1. **<span style="color: #008000">Responsiveness</span>**
   1. í”„ë¡œì„¸ìŠ¤ **ì¼ë¶€ê°€ block ë˜ì–´ë„ ê³„ì† ì‹¤í–‰ ê°€ëŠ¥**
2. **<span style="color: #008000">Resource Sharing</span>**
   1. ìŠ¤ë ˆë“œëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ìì›ì„ ê³µìœ 
   2. **ê³µìœ  ë©”ëª¨ë¦¬ë‚˜ ë©”ì‹œì§€ ì „ë‹¬ë³´ë‹¤ íš¨ìœ¨ì **
3. **<span style="color: #008000">Economy</span>**
   1. í”„ë¡œì„¸ìŠ¤ ìƒì„±ë³´ë‹¤ ì €ë ´
   2. ìŠ¤ë ˆë“œ ì „í™˜ì´ `context switching` ë³´ë‹¤ ì˜¤ë²„í—¤ë“œê°€ ë‚®ìŒ
4. **<span style="color: #008000">Scalability</span>**
   1. `Multicore architecture` í™œìš© ê°€ëŠ¥

## Multicore Programming
---
Multicoreí™˜ê²½ì€ ëª‡ê°€ì§€ì˜ ë„ì „ê³¼ì œê°€ ìˆì—ˆë‹¤.
1. `Dividing activities`
2. `Balance`
3. `Data splitting`
4. `Data dependency`
5. `Testing and debugging`

* **<span style="color: #008000">Parallelism(ë³‘ë ¬)</span>**: **ì—¬ëŸ¬ê°œì˜ ì½”ì–´/CPUê°€ 'ë™ì‹œì—' ì—¬ëŸ¬ê°œì˜ taskë¥¼ ì§„í–‰**í•¨, ì§„ì§œë¡œ ë™ì‹œì— ì—¬ëŸ¬ ì‘ì—…ì´ ì‹¤í–‰(simultaneously) ë˜ëŠ” ê²ƒ
* **<span style="color: #008000">Concurrency(ë³‘í–‰)</span>**: í•˜ë‚˜ì˜ ì½”ì–´/CPUê°€ **ì—¬ëŸ¬ ê°œì˜ taskë¥¼ ì‹œê°„ì„ ë¶„í• í•´ì„œ ë™ì‹œì— ì§„í–‰í•¨**(=scheduler)

![alt text](../assets/img/OS/Parallelism.png)
> **single-coreì˜ ê²½ìš°:** í•˜ë‚˜ì˜ ì½”ì–´ê°€ ì‹œê°„ì„ ì¡°ê°ë‚´ì–´ ì—¬ëŸ¬ taskë¥¼ ë²ˆê°ˆì•„ê°€ë©° ì‹¤í–‰. 
> ì‹¤ì œë¡œëŠ” í•œ ë²ˆì— í•˜ë‚˜ì´ì§€ë§Œ, ë¹ ë¥¸ ì „í™˜ìœ¼ë¡œ ë§ˆì¹˜ 'ë™ì‹œì—' ì‹¤í–‰í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì„  
> **multi-coreì˜ ê²½ìš°:** ì—¬ëŸ¬ ì½”ì–´ê°€ ê°ê° ë‹¤ë¥¸ taskë¥¼ ë™ì‹œì— ì‹¤í–‰

### Type of parallelism
  * **<span style="color: #008000">Data parallelism</span>**: **ë™ì¼í•œ ë°ì´í„°ì…‹ì˜ ì—¬ëŸ¬ ë¶€ë¶„ì„ ì—¬ëŸ¬ ì½”ì–´ì— ë¶„ë°°í•˜ì—¬ ë™ì¼í•œ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ì‹**(ì˜ˆ: í° ì´ë¯¸ì§€ë¥¼ ì—¬ëŸ¬ ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ê° ì½”ì–´ì—ì„œ ê°™ì€ í•„í„°ë¥¼ ì ìš©í•˜ëŠ” ê²½ìš°)
  * **<span style="color: #008000">Task parallelism</span>**: **ì„œë¡œ ë‹¤ë¥¸ ìŠ¤ë ˆë“œë¥¼ ì—¬ëŸ¬ ì½”ì–´ì— ë¶„ë°°í•˜ì—¬ ê° ìŠ¤ë ˆë“œê°€ ì„œë¡œ ë‹¤ë¥¸ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ì‹**(ì˜ˆ: ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œëŠ” UIë¥¼ ì²˜ë¦¬í•˜ê³ , ë‹¤ë¥¸ ìŠ¤ë ˆë“œëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ê²½ìš°)

![alt text](../assets/img/OS/Type_of_parallelism.png)

### Amdahl's Law
---
ğŸ“šì• í”Œë¦¬ì¼€ì´ì…˜ì— ì½”ì–´ë¥¼ ì¶”ê°€í–ˆì„ ë•Œ ì–»ì„ ìˆ˜ ìˆëŠ” ì„±ëŠ¥ í–¥ìƒì„ ì‹ë³„í•¨
* ê²°ë¡ : **ì½”ì–´ì˜ ìˆ˜ê°€ 2ë°°ê°€ ëœë‹¤ê³  ì„±ëŠ¥ì´ 2ë°° ì¢‹ì•„ì§€ì§„ ì•ŠëŠ”ë‹¤(1.6ë°° í–¥ìƒ)**

![alt text](../assets/img/OS/Amdahl.png)
> `S: ì§ë ¬ ë¶€ë¶„ ë¹„ìœ¨(%)`, `1-S: ë³‘ë ¬ ë¹„ìœ¨`, `N: processing core ìˆ˜`  
> ë§Œì•½ ì–´ë–¤ taskì˜ 75%ê°€ ë³‘ë ¬ì´ ê°€ëŠ¥í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ì§ë ¬ë§Œ(25%) ê°€ëŠ¥í•  ë•Œ, ì½”ì–´ê°€ 2ë°°ê°€ ë˜ë©´ ìµœëŒ€ íš¨ìœ¨ì€ 1.6ë°°ì´ë‹¤.  
> ì¦‰, ìµœëŒ€ì˜ speedupì„ ìœ„í•´ì„  ì§ë ¬ë§Œ ê°€ëŠ¥í•œ í”„ë¡œê·¸ë¨ì´ ì ì–´ì•¼í•œë‹¤

![alt text](../assets/img/OS/Amdahl_graph.png)
> Sê°€ 50%ì¸ ê²½ìš° ì•„ë¬´ë¦¬ coreë¥¼ ëŠ˜ë ¤ë„ speedê°€ 2ë°°ê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤.

### User Threads and Kernel Threads
---
âœ… **processì™€ theadë¥¼ í˜¼ë™í•  ìˆ˜ ìˆë‹¤** â†’ í˜„ì¬ëŠ” ê±°ì˜ ëª¨ë‘ threadë¥¼ ì‚¬ìš©í•œë‹¤.  
ì˜›ë‚ ì—ëŠ” processë‹¨ìœ„ë¡œ schedulerë¥¼ í–ˆì§€ë§Œ **í˜„ì¬ëŠ” thread ë‹¨ìœ„ë¡œ í•¨**

* **<span style="color: #008000">User threads</span>**: management done by **user-level threads library**
* **Three primary thread libraries:**
  * `POSIX Ptheads`: threadì˜ ì‹œë°œì  / í˜„ì¬ëŠ” kernel level
  * `Windows threads`
  * `Java threads`

* **<span style="color: #008000">Kernel threads</span>**: Supported by the Kernel
* ëŒ€ë¶€ë¶„ì˜ í˜„ëŒ€ ë²”ìš© ìš´ì˜ì²´ì œì—ì„œ ì§€ì›:
  * `Windows`
  * `Linux`
  * `Mac OS X`
  * `iOS`
  * `Andriod`

![alt text](../assets/img/OS/threads.png)
> ê°œë…ì ìœ¼ë¡œëŠ” **userì™€ kernelì´ ë¶„ë¦¬**ë¨

{:.prompt-tip}
> ê·¸ ë¶„ë¦¬ë¥¼ í•©ì¹˜ê¸° ìœ„í•œ ë°©ë²•ì´ ìˆë‹¤.
> 

#### 1. Many-to-One
---
ğŸ“š**<span style="color: #008000">Many-to-One</span>**: **ì—¬ëŸ¬ User Thread**ê°€ **í•˜ë‚˜ì˜ Kernel Thread**ì— **Mapping**ë˜ëŠ” ë°©ì‹

![alt text](../assets/img/OS/Many_to_One.png)

âœ…ì¥ì :  
  * ì›í•˜ëŠ” ë§Œí¼ ë§ì€ ì‚¬ìš©ì ìŠ¤ë ˆë“œ ìƒì„± ê°€ëŠ¥

âŒë‹¨ì :  
  * ë³‘ë ¬ ì²˜ë¦¬ ë¶ˆê°€ëŠ¥ â†’ ë©€í‹°ì½”ì–´ì˜ ì¥ì  ëª» ì‚´ë¦¼ 
  * í•˜ë‚˜ë¼ë„ ë¸”ë¡œí‚¹ë˜ë©´ ì „ë¶€ ë©ˆì¶¤ â†’ íš¨ìœ¨ì„± ì €í•˜
í˜„ì¬ëŠ” ê±°ì˜ ì‚¬ìš© X

#### 2. One-to-One
---
ê° í•˜ë‚˜ì˜ ìœ ì € ìŠ¤ë ˆë“œì— ì»¤ë„ ìŠ¤ë ˆë“œê°€ ë§¤í•‘ë¨
â†’ user threadë¥¼ ìƒì„±í•˜ë©´ kernel threadë„ í•¨ê»˜ ìƒì„±ë¨

âœ…ì¥ì :  
  * ìŠ¤ë ˆë“œê°€ ë¸”ë¡œí‚¹ë˜ì–´ë„ ë‹¤ë¥¸ ìŠ¤ë ˆë“œ ì‹¤í–‰ ê°€ëŠ¥
  * ì—¬ëŸ¬ ìŠ¤ë ˆë“œë¥¼ **ë‹¤ì¤‘ì½”ì–´ì— ë§¤í•‘ ê°€ëŠ¥**
  
âŒë‹¨ì :  
  * ìŠ¤ë ˆë“œ ìƒì„± ì‹œ **ì˜¤ë²„í—¤ë“œ ë•Œë¬¸ì— í”„ë¡œì„¸ìŠ¤ë‹¹ ìŠ¤ë ˆë“œ ìˆ˜ê°€ ì œí•œ**ë  ìˆ˜ ìˆìŒ

#### 3. Many-to-Many Model
---
**ì—¬ëŸ¬ê°œì˜ ìœ ì € ìŠ¤ë ˆë“œë¥¼ ì—¬ëŸ¬ê°œì˜ ì»¤ë„ ìŠ¤ë ˆë“œì— ë§¤í•‘ë˜ëŠ” ë°©ì‹**

âœ…ì¥ì :  
  * ì‚¬ìš©ì ìŠ¤ë ˆë“œë¥¼ ë§ˆìŒëŒ€ë¡œ ìƒì„± ê°€ëŠ¥ + ë©€í‹°ì½”ì–´ì—ì„œ ë³‘ë ¬ë¡œ ì‹¤í–‰ê°€ëŠ¥

âŒë‹¨ì :  
  * ì—¬ëŸ¬ê°œì˜ ì…ë ¥ê³¼ ì—¬ëŸ¬ê°œì˜ ì¶œë ¥ì„ ìŠ¤ìœ„ì¹­í•´ì¤˜ì•¼í•˜ëŠ”ë° ê·¸ ë¹„ìš©ì´ ìƒë‹¹í•¨ â†’ êµ¬í˜„ì´ ì–´ë ¤ì›€

## Thread Library
---
ğŸ“š**<span style="color: #008000">Thread Library</span>**: í”„ë¡œê·¸ë˜ë¨¸ì—ê²Œ **ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” API(Application Programming Interface)ë¥¼ ì œê³µ**

ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„:
1. **user spaceì—ë§Œ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬:**
  * ëª¨ë“  ìŠ¤ë ˆë“œ ì½”ë“œê°€ ì‚¬ìš©ì ê³µê°„ì—ì„œ ì‹¤í–‰ë¨
  * ì»¤ë„ì€ ìŠ¤ë ˆë“œì˜ ì¡´ì¬ë¥¼ ì¸ì‹í•˜ì§€ ëª»í•¨
2. **kernel-levelì—ì„œ ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬:**
  * ìŠ¤ë ˆë“œ ìƒì„± ë° ê´€ë¦¬ê°€ ì»¤ë„ì— ì˜í•´ ìˆ˜í–‰ë¨
  * ì‹œìŠ¤í…œ ì½œì„ í†µí•´ ì»¤ë„ê³¼ í†µì‹ 

* `Asynchronous Threading`: ë¶€ëª¨ì™€ ìì‹ ìŠ¤ë ˆë“œê°€ **ë…ë¦½ì ìœ¼ë¡œ ë³‘í–‰ ì‹¤í–‰**
* `Synchronous Threading`: ë¶€ëª¨ ìŠ¤ë ˆë“œëŠ” **ëª¨ë“  ìì‹ ìŠ¤ë ˆë“œê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼**  
> ë¶€ëª¨ ìŠ¤ë ˆë“œëŠ” ë©”ì¸ ìŠ¤ë ˆë“œ, ìì‹ ìŠ¤ë ˆë“œëŠ” ì„œë¸Œ ìŠ¤ë ˆë“œë¼ê³ ë„ í•œë‹¤.  
> `POSIX Pthreads`: user or kernel level  
> `Windows threads`: kernel level  
> `javathreads`: depending on OS  

### Pthreads
---
ì‚¬ìš©ì ìˆ˜ì¤€ì´ë‚˜ ì»¤ë„ ìˆ˜ì¤€ìœ¼ë¡œ ì œê³µë  ìˆ˜ ìˆìŒ
* **ìŠ¤ë ˆë“œ ìƒì„± ë° ë™ê¸°í™”ë¥¼ ìœ„í•œ API**
* í‘œì¤€ë§Œ ì •ì˜: **ì‹¤ì œ êµ¬í˜„ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°œë°œìì—ê²Œ ë§¡ê¹€**

#### ìŠ¤ë ˆë“œ ìƒì„±

```c
#include <pthread.h>

int pthread_create(pthread_t *thread, const pthread_attr_t *attr,
                  void *(*start_routine)(void *), void *arg);
```
* `thread`: ìƒì„±ëœ ìŠ¤ë ˆë“œì˜ IDë¥¼ ì €ì¥í•  í¬ì¸í„°  
* `attr`: ìŠ¤ë ˆë“œì˜ ì†ì„±(NULLì´ë©´ ê¸°ë³¸ê°’)  
* `start_routine`: ìŠ¤ë ˆë“œê°€ ì‹¤í–‰í•  í•¨ìˆ˜ ì£¼ì†Œ  
* `arg`: ì‹œì‘ í•¨ìˆ˜ì— ì „ë‹¬í•  ì¸ì  

```c
/* Example pthread */

#include <pthread.h>
#include <stdio.h>
#include <stdlib.h>

int sum; /* this data is **shared** by the thread(s) */
void *runner(void *param); /* threads call this function */

int main(int argc, char *argv[])
{
  pthread_t tid; /* ìŠ¤ë ˆë“œ ì‹ë³„ì */
  pthread_attr_t attr; /* ìŠ¤ë ˆë“œ ì†ì„± ì§‘í•© */

  /* set the default attributes of the thread */
  pthread_attr_init(&attr);
  /* create the thread */
  pthread_create(&tid, &attr, runner, argv[1]);
  /* wait for the thread to exit */
  pthread_join(tid, NULL);

  printf("sum= %d\n", sum);
}

void *runner(void *param)
{
  int i, upper=atoi(param);
  sum =0;
  for(i=1; i<=upper; i++)
    sum += i;

  pthread_exit(0);
}

// 10ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ê³  ì™„ì „íˆ ì¢…ë£Œë  ë•Œê¹Œì§€ main threadê°€ ê¸°ë‹¤ë¦¬ëŠ” ì½”ë“œ
#define NUM_THREADS 10

/* an array of threads to be joined upon */
pthread_t workers[NUM_THREADS];

for(int i = 0; i<NUM_THREADS; i++)
  pthread_join(workers[i], NULL); // ìŠ¤ë ˆë“œ ì¢…ë£Œ ëŒ€ê¸°
```