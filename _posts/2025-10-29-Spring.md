---
title: "[ğŸƒSpring] ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™"

categories: [Framework, Spring]
tags:
  - [JAVA, Spring, ë°ì´í„°ë² ì´ìŠ¤, JDBC, JPA, Repository, Service, DTO]
toc: true
toc_sticky: true

date: 2025-10-29
last_modified_at: 2025-10-29
---

>ğŸƒ Spring Framework ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ ì •ë¦¬

## **<span style="color: #008000">JDBC</span>**
---
ğŸ“š **JDBC(Java Database Connectivity)**: ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ìë°” í‘œì¤€ API

ìŠ¤í”„ë§ì„ ì‚¬ìš©í•  ë•Œ DBì™€ ì—°ê²°, SQL ì¿¼ë¦¬ ì „ì†¡ ë“±ì˜ ëª©ì ìœ¼ë¡œ í•„ìˆ˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.

### ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
---
```java
public abstract class ConnectionConst {
    public static final String URL = "jdbc:h2:tcp://localhost/~/test";
    public static final String USERNAME = "sa";
    public static final String PASSWORD = "";
}

public class DBConnectionUtil {
    public static Connection getConnection() {
        try {
            Connection connection = DriverManager.getConnection(URL, USERNAME, PASSWORD);
            return connection;
        } catch (SQLException e) {
            throw new IllegalStateException(e);
        }
    }
}
```

### JDBC DriverManager
---
![JDBC DriverManager](../assets/img/Spring/image.png)

* **<span style="color: #008000">DriverManager</span>**: JDBC ë“œë¼ì´ë²„ë¥¼ ê´€ë¦¬í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ ìƒì„±í•˜ëŠ” ì—­í• 
* ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ì´ì˜ ì—°ê²°ì„ ì¤‘ê°œ

### JDBCë¡œ ì¿¼ë¦¬ ì „ì†¡í•˜ê¸°
---
```java
public class MemberRepositoryV0 {

    public Member save(Member member) throws SQLException {
        String sql = "insert into member(member_id, money) values(?, ?)";
        Connection con = null;
        PreparedStatement pstmt = null;

        try {
            con = getConnection();
            pstmt = con.prepareStatement(sql);
            pstmt.setString(1, member.getMemberId());
            pstmt.setInt(2, member.getMoney());
            pstmt.executeUpdate();
            return member;
        } catch (SQLException e) {
            log.error("db error", e);
            throw e;
        } finally {
            close(con, pstmt, null);
        }
    }

    private void close(Connection con, Statement stmt, ResultSet rs) {
        if (rs != null) {
            try {
                rs.close();
            } catch (SQLException e) {
                log.info("error", e);
            }
        }
        if (stmt != null) {
            try {
                stmt.close();
            } catch (SQLException e) {
                log.info("error", e);
            }
        }
        if (con != null) {
            try {
                con.close();
            } catch (SQLException e) {
                log.info("error", e);
            }
        }
    }

    private Connection getConnection() {
        return DBConnectionUtil.getConnection();
    }
}
```

JDBCë¥¼ ì‚¬ìš©í•˜ë©´ DB ì—°ê²°, ì¿¼ë¦¬ ì‘ì„±, ì—°ê²° í•´ì œ ë“± **ë°˜ë³µì ì¸ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ**ê°€ ë„ˆë¬´ ë§ì´ í•„ìš”í•˜ë‹¤.

ê·¸ë˜ì„œ ì‹¤ë¬´ì—ì„œëŠ” JDBCë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ê¸°ë³´ë‹¤ **JPAì™€ í•¨ê»˜ ì‚¬ìš©**í•˜ì—¬ ì´ëŸ¬í•œ ë³µì¡ì„±ì„ ì¤„ì¸ë‹¤.

-----

## **<span style="color: #008000">JPA</span>**
---
ğŸ“š **JPA(Java Persistence API)**: ìë°” ê°ì²´ì™€ ê´€ê³„í˜• DB í…Œì´ë¸”ì„ ë§¤í•‘í•´ì£¼ëŠ” ORM(Object-Relational Mapping) ê¸°ìˆ 

JPA ì—†ì´ ê´€ê³„í˜• DBì™€ ìë°”ê°€ ìƒí˜¸ì‘ìš©í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë¶ˆí¸í•¨ì´ ìˆë‹¤:
* ì—°ê´€ ê´€ê³„ë¥¼ ì§ì ‘ SQLë¡œ êµ¬í˜„í•´ì•¼ í•¨
* ìë°”ì˜ ìƒì† êµ¬ì¡°ë¥¼ DBì— í‘œí˜„í•˜ê¸° ì–´ë ¤ì›€
* ë°˜ë³µì ì¸ CRUD SQL ì‘ì„±

**JPAë¥¼ ì‚¬ìš©í•˜ë©´ ìë°” ê°ì²´ë¥¼ ë‹¤ë£¨ë“¯ì´ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ìë™ìœ¼ë¡œ SQL ì¿¼ë¦¬ê°€ ìƒì„±ë˜ì–´ DBë¡œ ì „ì†¡ëœë‹¤.**

### JPA ë™ì‘ ë°©ì‹
---
![JPA ë™ì‘ ë°©ì‹](../assets/img/Spring/image%201.png)

* JPAëŠ” **JDBCë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©**í•˜ì§€ë§Œ ê°œë°œìê°€ ì§ì ‘ JDBC ì½”ë“œë¥¼ ì‘ì„±í•  í•„ìš”ê°€ ì—†ìŒ
* **ê°ì²´ ì§€í–¥ì ì¸ ë°©ì‹**ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë‹¤ë£° ìˆ˜ ìˆê²Œ í•´ì¤Œ

-----

## **<span style="color: #008000">ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì • (MySQL + JPA)</span>**
---

### ì˜ì¡´ì„± ì¶”ê°€ (build.gradle)
---
```gradle
dependencies {
    runtimeOnly 'com.mysql:mysql-connector-j'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
}
```

### ìŠ¤í”„ë§ ì„¤ì • íŒŒì¼ (application.yml)
---
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/haein
    username: root
    password: password
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        format_sql: true
        show_sql: true
```

* **`ddl-auto: update`**: ì—”í‹°í‹° ë³€ê²½ì‚¬í•­ì„ ìë™ìœ¼ë¡œ DB ìŠ¤í‚¤ë§ˆì— ë°˜ì˜
* **`show_sql: true`**: ì‹¤í–‰ë˜ëŠ” SQL ì¿¼ë¦¬ë¥¼ ì½˜ì†”ì— ì¶œë ¥

-----

## **<span style="color: #008000">ì—”í‹°í‹°ë¡œ DB í…Œì´ë¸” êµ¬í˜„í•˜ê¸° (N:1 ì—°ê´€ê´€ê³„)</span>**
---

### DB ìŠ¤í‚¤ë§ˆ ì„¤ê³„
---
![DB ìŠ¤í‚¤ë§ˆ](../assets/img/Spring/image%202.png)

Memberì™€ Post ì—”í‹°í‹°ê°€ **ì¼ëŒ€ë‹¤(1:N) ê´€ê³„**ë¥¼ ê°€ì§„ ìŠ¤í‚¤ë§ˆ ì„¤ê³„ ì˜ˆì‹œ

> ERD ì„¤ê³„ ë„êµ¬: [https://www.erdcloud.com/](https://www.erdcloud.com/)

### Member ì—”í‹°í‹° êµ¬í˜„
---
```java
@Entity // DB í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” ì—”í‹°í‹°ì„ì„ ëª…ì‹œ
@Getter
public class Member {
    @Id // Primary Key
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "member_id")
    private Long id;

    private String name;
    private String email;
    private String password;

    // ì¼ëŒ€ë‹¤ ê´€ê³„ì˜ '1' ìª½ ì„¤ì •
    // Member í•˜ë‚˜ê°€ ì—¬ëŸ¬ Postë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŒ
    // mappedBy: ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹˜ì„ ëª…ì‹œ (Postì˜ writer í•„ë“œì—ì„œ ê´€ë¦¬)
    @OneToMany(mappedBy = "writer")
    private List<Post> posts = new ArrayList<>();
}
```

* **`@Entity`**: ì´ í´ë˜ìŠ¤ê°€ JPA ì—”í‹°í‹°ì„ì„ ì„ ì–¸
* **`@Id`**: Primary Key í•„ë“œ ì§€ì •
* **`@GeneratedValue`**: PK ê°’ ìë™ ìƒì„± ì „ëµ (IDENTITY: DBì˜ AUTO_INCREMENT ì‚¬ìš©)
* **`@OneToMany(mappedBy = "writer")`**: ì¼ëŒ€ë‹¤ ê´€ê³„ ì„¤ì •. `mappedBy`ëŠ” ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹˜ì„ í‘œì‹œ

#### @OneToMany í•„ë“œë¥¼ ë‘ëŠ” ì´ìœ 
---
```java
List<Post> posts = member.getPosts(); // ë§¤ìš° ê°„ë‹¨í•œ ì¡°íšŒ
```

JDBCë¥¼ ì‚¬ìš©í•˜ë©´ memberì˜ ëª¨ë“  postë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•´ ì§ì ‘ SQL ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì•¼ í•˜ì§€ë§Œ, **JPAë¥¼ ì‚¬ìš©í•˜ë©´ getter í•˜ë‚˜ë¡œ ê°ì²´ì§€í–¥ì ìœ¼ë¡œ ì¡°íšŒ**í•  ìˆ˜ ìˆë‹¤.

### Post ì—”í‹°í‹° êµ¬í˜„
---
```java
@Entity
@Getter
public class Post {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "post_id")
    private Long id;

    private String title;
    private String content;

    // ë‹¤ëŒ€ì¼ ê´€ê³„ì˜ 'N' ìª½ ì„¤ì •
    // ì—¬ëŸ¬ Postê°€ í•˜ë‚˜ì˜ Memberë¥¼ ì°¸ì¡°
    @ManyToOne
    @JoinColumn(name = "member_id") // FK ì»¬ëŸ¼ ì´ë¦„ ì§€ì •
    private Member writer; // ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
}
```

* **`@ManyToOne`**: ë‹¤ëŒ€ì¼ ê´€ê³„ ì„¤ì •
* **`@JoinColumn(name = "member_id")`**:
  * Post í…Œì´ë¸”ì— `member_id`ë¼ëŠ” FK ì»¬ëŸ¼ ìƒì„±
  * Member ì—”í‹°í‹°ì˜ PK ê°’ì„ ì €ì¥
* **`@ManyToOne`ì„ ë¶™ì¸ í•„ë“œëŠ” ì‹¤ì œ DB ì»¬ëŸ¼ì— ì €ì¥ë¨** (ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸)

-----

## **<span style="color: #008000">ì—°ê´€ê´€ê³„ ë§¤í•‘ ì‹œ ê³ ë ¤ì‚¬í•­</span>**
---

### 1. ì§€ì—° ë¡œë”© (Lazy Loading)
---
**ë¬¸ì œ ìƒí™©**: ê²Œì‹œë¬¼ 100ê°œë¥¼ ì¡°íšŒí•  ë•Œ ì—°ê´€ëœ Member ì •ë³´ 100ê°œë„ í•¨ê»˜ ë¶ˆëŸ¬ì˜¨ë‹¤ë©´?
ê²Œì‹œë¬¼ ì œëª©ë§Œ í•„ìš”í•œ ê²½ìš°, ë©¤ë²„ ì •ë³´ ì¡°íšŒëŠ” ë¶ˆí•„ìš”í•œ ì„±ëŠ¥ ë‚­ë¹„ë‹¤.

```java
@ManyToOne(fetch = FetchType.LAZY) // ì§€ì—° ë¡œë”© ì„¤ì •
@JoinColumn(name = "member_id")
private Member writer;
```

* **<span style="color: #008000">ì§€ì—° ë¡œë”©</span>**: ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” ì‹œì ì— ì¡°íšŒ
* `postRepository.findAll()` ì‹¤í–‰ ì‹œ `writer` í•„ë“œì—ëŠ” **í”„ë¡ì‹œ(ê°€ì§œ) ê°ì²´**ê°€ ë“¤ì–´ê°
* `post.getWriter().getName()` ë“±ìœ¼ë¡œ ì‹¤ì œ ì ‘ê·¼í•  ë•Œ DB ì¿¼ë¦¬ ì‹¤í–‰

#### í”„ë¡ì‹œ ê°ì²´
---
![í”„ë¡ì‹œ ê°ì²´](../assets/img/Spring/image%203.png)

* ì§„ì§œ ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì•„ JPAê°€ ìë™ìœ¼ë¡œ ìƒì„±
* ì‹¤ì œ ì‚¬ìš© ì‹œì ê¹Œì§€ DB ì¡°íšŒë¥¼ ë¯¸ë£¸

{:.prompt-tip}
> **ì„±ëŠ¥ ìµœì í™”**: ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ `LAZY`ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì„ ìŠµê´€í™”í•˜ì!

**ì¦‰ì‹œ ë¡œë”©(EAGER)**: ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì¦‰ì‹œ ì¡°íšŒ (ì„±ëŠ¥ ë¬¸ì œë¡œ ê±°ì˜ ì‚¬ìš© ì•ˆ í•¨)

### 2. ì˜ì†ì„± ì „ì´ (Cascade)
---
```java
// Member ì‚­ì œ ì‹œ ì—°ê´€ëœ Postë“¤ë„ í•¨ê»˜ ì‚­ì œ
@OneToMany(mappedBy = "writer", cascade = CascadeType.REMOVE)
private List<Post> posts = new ArrayList<>();
```

* **`CascadeType.REMOVE`**: ë¶€ëª¨ ì—”í‹°í‹° ì‚­ì œ ì‹œ ìì‹ ì—”í‹°í‹°ë„ í•¨ê»˜ ì‚­ì œ
* **`CascadeType.PERSIST`**: ë¶€ëª¨ ì—”í‹°í‹° ì €ì¥ ì‹œ ìì‹ ì—”í‹°í‹°ë„ í•¨ê»˜ ì €ì¥

ë©¤ë²„ íƒˆí‡´ ì‹œ ê²Œì‹œê¸€ì„ ì¼ì¼ì´ ì°¾ì•„ ì‚­ì œí•  í•„ìš” ì—†ì´ JPAê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.

-----

## **<span style="color: #008000">ê³„ì¸µí˜• ì•„í‚¤í…ì²˜: Repository-Service-Controller</span>**
---
![ê³„ì¸µí˜• ì•„í‚¤í…ì²˜](../assets/img/Spring/image%204.png)

ìŠ¤í”„ë§ì—ì„œëŠ” **ì—­í• ì„ ê³„ì¸µë³„ë¡œ ë¶„ë¦¬**í•˜ì—¬ ì½”ë“œë¥¼ ê´€ë¦¬í•œë‹¤.

### Repository
---
ğŸ“š **Repository**: ë°ì´í„°ë² ì´ìŠ¤ì™€ ì§ì ‘ í†µì‹ í•˜ëŠ” ê³„ì¸µ (Data Access Layer)

```java
public interface UserRepository extends JpaRepository<User, Long> {
    // JPAê°€ ë©”ì„œë“œ ì´ë¦„ì„ ë¶„ì„í•˜ì—¬ ìë™ìœ¼ë¡œ ì¿¼ë¦¬ ìƒì„±
    Optional<Member> findByName(String name);
}
```

* **`JpaRepository<ì—”í‹°í‹° íƒ€ì…, PK íƒ€ì…>`** ìƒì†
* **ê¸°ë³¸ CRUD ë©”ì„œë“œ ìë™ ì œê³µ**: `save()`, `findById()`, `findAll()`, `deleteById()` ë“±
* **ë©”ì„œë“œ ì´ë¦„ ê·œì¹™**ìœ¼ë¡œ ì»¤ìŠ¤í…€ ì¿¼ë¦¬ ìƒì„±: `findBy + í•„ë“œëª…`
* **êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•  í•„ìš” ì—†ìŒ** (ìŠ¤í”„ë§ì´ ëŸ°íƒ€ì„ì— ìë™ ìƒì„±)

### Service
---
ğŸ“š **Service**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ê³„ì¸µ

```java
@Service
@RequiredArgsConstructor // final í•„ë“œ ìƒì„±ì ìë™ ìƒì„± (ì˜ì¡´ì„± ì£¼ì…)
public class UserService {
    private final UserRepository userRepository;

    // ì‚¬ìš©ì ì €ì¥
    public User createUser(User user) {
        return userRepository.save(user);
    }

    // ì‚¬ìš©ì ì‚­ì œ
    public void deleteUser(Long id) {
        userRepository.deleteById(id);
    }

    // IDë¡œ ì‚¬ìš©ì ì¡°íšŒ (Optional í™œìš©)
    public Member findOne(Long memberId) {
        return memberRepository.findById(memberId)
            .orElseThrow(() -> new IllegalArgumentException("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íšŒì›ì…ë‹ˆë‹¤."));
    }

    // ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ
    public User getUserByUsername(String username) {
        return userRepository.findByUsername(username);
    }

    // ì „ì²´ ì‚¬ìš©ì ì¡°íšŒ
    public List<User> getAllUsers() {
        return userRepository.findAll();
    }
}
```

* Repositoryì˜ ë©”ì„œë“œë¥¼ ì¡°í•©í•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
* íŠ¸ëœì­ì…˜ ê´€ë¦¬

### Controller
---
```java
@Controller
@RequiredArgsConstructor
public class UserController {
    private final UserService userService;

    @GetMapping("/users/{username}")
    public User getUser(@PathVariable String username) {
        return userService.getUserByUsername(username);
    }
}
```

* HTTP ìš”ì²­ì„ ë°›ì•„ Serviceë¥¼ í˜¸ì¶œí•˜ê³  ì‘ë‹µ ë°˜í™˜

-----

## **<span style="color: #008000">íŠ¸ëœì­ì…˜ ê´€ë¦¬</span>**
---
ğŸ“š **íŠ¸ëœì­ì…˜**: ì—¬ëŸ¬ DB ì‘ì—…ì„ í•˜ë‚˜ì˜ ë…¼ë¦¬ì  ë‹¨ìœ„ë¡œ ë¬¶ì–´ <u>ëª¨ë‘ ì„±ê³µí•˜ê±°ë‚˜ ëª¨ë‘ ì‹¤íŒ¨</u>í•˜ë„ë¡ ë³´ì¥

### @Transactional ì–´ë…¸í…Œì´ì…˜
---
```java
@Service
@RequiredArgsConstructor
public class AccountService {
    private final AccountRepository accountRepository;

    @Transactional // íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ìŒ
    public void transferMoney(Long fromAccountId, Long toAccountId, int amount) {
        // 1. ë³´ë‚´ëŠ” ê³„ì¢Œ ì¡°íšŒ
        Account fromAccount = accountRepository.findById(fromAccountId)
                .orElseThrow(() -> new IllegalArgumentException("ë³´ë‚´ëŠ” ê³„ì¢Œê°€ ì—†ìŠµë‹ˆë‹¤."));

        // 2. ë°›ëŠ” ê³„ì¢Œ ì¡°íšŒ
        Account toAccount = accountRepository.findById(toAccountId)
                .orElseThrow(() -> new IllegalArgumentException("ë°›ëŠ” ê³„ì¢Œê°€ ì—†ìŠµë‹ˆë‹¤."));

        // 3. ì¶œê¸ˆ
        fromAccount.withdraw(amount);

        // 4. ì˜ˆì™¸ ë°œìƒ ì‹œ ì „ì²´ ë¡¤ë°±
        if (toAccount.isInactive()) {
            throw new IllegalStateException("ë°›ëŠ” ê³„ì¢Œê°€ ë¹„í™œì„±í™” ìƒíƒœì…ë‹ˆë‹¤.");
        }

        // 5. ì…ê¸ˆ
        toAccount.deposit(amount);

        // JPAê°€ íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ ìë™ìœ¼ë¡œ UPDATE ì¿¼ë¦¬ ì‹¤í–‰
    }
}
```

* **ë©”ì„œë“œ ì„±ê³µ**: ìë™ Commit
* **ì˜ˆì™¸ ë°œìƒ**: ìë™ Rollback (ëª¨ë“  ë³€ê²½ì‚¬í•­ ì·¨ì†Œ)
* **ì£¼ë¡œ Service ê³„ì¸µ**ì—ì„œ ì‚¬ìš©

-----

## **<span style="color: #008000">DTOë¡œ ë°ì´í„° ì „ì†¡í•˜ê¸°</span>**
---
ğŸ“š **DTO(Data Transfer Object)**: ê³„ì¸µ ê°„ ë°ì´í„° ì „ì†¡ì„ ìœ„í•œ ê°ì²´

![DTO ê°œë…](../assets/img/Spring/image%205.png)

![DTO ë¹„ìœ ](../assets/img/Spring/image%206.png)

### ì¼ë°˜ì ì¸ ë°©ì‹ì˜ ë¹„íš¨ìœ¨
---
```java
@Service
public class WaitingService {
    @Autowired
    private WaitingRepository waitingRepository;

    // âŒ ë¹„íš¨ìœ¨: ì—”í‹°í‹° ì „ì²´ ì¡°íšŒ í›„ DTO ë³€í™˜
    public List<WaitingListDTO> getWaitingList(Long pubId) {
        // 1ë‹¨ê³„: ë¶ˆí•„ìš”í•œ ì»¬ëŸ¼ê¹Œì§€ ëª¨ë‘ ì¡°íšŒ
        List<Waiting> waitings = waitingRepository.findByPubId(pubId);

        // 2ë‹¨ê³„: Streamìœ¼ë¡œ DTO ë³€í™˜ (ë©”ëª¨ë¦¬ 2ë°° ì‚¬ìš©)
        return waitings.stream()
                .map(w -> new WaitingListDTO(
                    w.getId(),
                    w.getCustomerName(),
                    w.getCreatedAt()))
                .collect(Collectors.toList());
    }
}
```

### ê°œì„ ëœ ë°©ì‹: Repositoryì—ì„œ ë°”ë¡œ DTO ë°˜í™˜
---
```java
// DTO í´ë˜ìŠ¤
@Getter
@AllArgsConstructor
public class WaitingListDTO {
    private Long id;
    private String customerName;
    private LocalDateTime createdAt;
}

// Repository: JPQLë¡œ í•„ìš”í•œ ì»¬ëŸ¼ë§Œ SELECTí•˜ì—¬ DTO ìƒì„±
@Repository
public interface WaitingRepository extends JpaRepository<Waiting, Long> {
    @Query("SELECT new com.example.dto.WaitingListDTO(w.id, w.customerName, w.createdAt) " +
           "FROM Waiting w WHERE w.pubId = :pubId")
    List<WaitingListDTO> findWaitingDTOByPubId(@Param("pubId") Long pubId);
}

// Service: ë³€í™˜ ê³¼ì • ì—†ì´ ë°”ë¡œ ë°˜í™˜
@Service
public class WaitingService {
    @Autowired
    private WaitingRepository waitingRepository;

    public List<WaitingListDTO> getWaitingList(Long pubId) {
        return waitingRepository.findWaitingDTOByPubId(pubId);
    }
}
```

**ê°œì„  íš¨ê³¼**:
* í•„ìš”í•œ ì»¬ëŸ¼ë§Œ SELECT (ë„¤íŠ¸ì›Œí¬ ë¶€í•˜ ê°ì†Œ)
* ì—”í‹°í‹°â†’DTO ë³€í™˜ ê³¼ì • ìƒëµ (ë©”ëª¨ë¦¬ ì ˆì•½)
* ì½”ë“œ ê°„ê²°í™”

-----

## **<span style="color: #008000">Fetch Joinìœ¼ë¡œ N+1 ë¬¸ì œ í•´ê²°</span>**
---

### N+1 ë¬¸ì œë€?
---
```java
// âŒ N+1 ë¬¸ì œ ë°œìƒ
public void printTeamsAndMembers() {
    List<Team> teams = teamRepository.findAll();  // 1ë²ˆ ì¿¼ë¦¬

    for (Team team : teams) {
        System.out.println("íŒ€: " + team.getName());
        // ê° íŒ€ë§ˆë‹¤ members ì¡°íšŒ â†’ Në²ˆ ì¿¼ë¦¬ ë°œìƒ!
        for (Member member : team.getMembers()) {
            System.out.println("  - ë©¤ë²„: " + member.getName());
        }
    }
    // ì´ 1 + Në²ˆì˜ ì¿¼ë¦¬ ì‹¤í–‰ (ë¹„íš¨ìœ¨)
}
```

### Fetch Joinìœ¼ë¡œ í•´ê²°
---
```java
// Repository: Fetch Join ì‚¬ìš©
@Query("SELECT DISTINCT t FROM Team t JOIN FETCH t.members")
List<Team> findAllWithMembers();

// Service: 1ë²ˆì˜ ì¿¼ë¦¬ë¡œ í•´ê²°
public void printTeamsAndMembers() {
    List<Team> teams = teamRepository.findAllWithMembers(); // 1ë²ˆ ì¿¼ë¦¬ë¡œ Team + Member ëª¨ë‘ ì¡°íšŒ

    for (Team team : teams) {
        System.out.println("íŒ€: " + team.getName());
        for (Member member : team.getMembers()) {
            System.out.println("  - ë©¤ë²„: " + member.getName());
        }
    }
}
```

* **Fetch Join**: ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ í•¨ê»˜ ì¡°íšŒ
* **N+1 ë¬¸ì œ í•´ê²°**: 1 + Në²ˆ â†’ 1ë²ˆìœ¼ë¡œ ì¿¼ë¦¬ ìˆ˜ ê°ì†Œ

-----

## **<span style="color: #008000">ìŠ¤í”„ë§ì˜ ë©€í‹°ìŠ¤ë ˆë“œì™€ ë™ê¸° I/O</span>**
---

### ìŠ¤í”„ë§ì˜ ìŠ¤ë ˆë“œ í’€
---
![ìŠ¤í”„ë§ì˜ ì“°ë ˆë“œ í’€](../assets/img/Spring/image%207.png)

* **ë©€í‹°ìŠ¤ë ˆë“œ ë°©ì‹**: ì—¬ëŸ¬ ì‚¬ìš©ì ìš”ì²­ì„ ë™ì‹œ ì²˜ë¦¬
* **ìŠ¤ë ˆë“œ í’€**: ë¯¸ë¦¬ ìƒì„±ëœ ì›Œì»¤ ìŠ¤ë ˆë“œë¥¼ ì¬ì‚¬ìš©
* ìš”ì²­ ì²˜ë¦¬ ì™„ë£Œ í›„ ìŠ¤ë ˆë“œëŠ” ë‹¤ì‹œ í’€ë¡œ ë°˜í™˜

### Blocking I/O ë°©ì‹
---
![Blocking I/O](../assets/img/Spring/image%208.png)

* **ë™ê¸° I/O**: I/O ì‘ì—… ì™„ë£Œê¹Œì§€ ìŠ¤ë ˆë“œ ëŒ€ê¸° (Block)
* DB ì¡°íšŒì— 1ì´ˆ ê±¸ë ¤ë„ ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì²˜ë¦¬ë˜ë¯€ë¡œ ì „ì²´ ì„œë²„ê°€ ë©ˆì¶”ì§€ëŠ” ì•ŠìŒ
* **ë‹¨, CPUê°€ I/O ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œë¥¼ WAIT ìƒíƒœë¡œ ì „í™˜í•˜ê³  ë‹¤ë¥¸ ìŠ¤ë ˆë“œë¥¼ ì‹¤í–‰**

### ìŠ¤ë ˆë“œ í’€ ê³ ê°ˆ ë¬¸ì œ (Thread Pool Exhaustion)
---
* ìš”ì²­ì´ í­ì¦í•˜ê³  ë§ì€ ìŠ¤ë ˆë“œê°€ I/O ëŒ€ê¸° ìƒíƒœë©´?
* ì›Œì»¤ ìŠ¤ë ˆë“œê°€ ëª¨ë‘ WAIT ìƒíƒœ â†’ ìƒˆ ìš”ì²­ ì²˜ë¦¬ ë¶ˆê°€
* **ë³‘ëª© í˜„ìƒ ë°œìƒ**

{:.prompt-info}
> **Non-blocking I/O**: ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë¹„ë™ê¸° ë°©ì‹ë„ ìˆë‹¤
> ì°¸ê³ : [https://velog.io/@yjl8628/Blocking-Non-blocking-IO](https://velog.io/@yjl8628/Blocking-Non-blocking-IO)

-----
