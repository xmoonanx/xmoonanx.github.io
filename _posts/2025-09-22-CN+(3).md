---
title: "[ğŸŒCN] Internet Protocol(3) - IP Header & Forwarding"

categories: [CS, Internet Protocol]
tags:
  - [CS, Internet Protocol, Computer Networking, Network layer, IP, Fragmentation, MTU, Routing, Forwarding]
toc: true
toc_sticky: true

date: 2025-09-22
last_modified_at: 2025-09-22
---
>ğŸŒ Internet Protocol ì „ê³µ ìˆ˜ì—… ì •ë¦¬

*IPëŠ” ì¸í„°ë„·ì˜ í—ˆë¦¬(waist of the hourglass)ë¼ ë¶ˆë¦°ë‹¤. ëª¨ë“  ìƒìœ„ ë ˆì´ì–´ í”„ë¡œí† ì½œê³¼ í•˜ìœ„ ë ˆì´ì–´ ê¸°ìˆ ë“¤ì´ IPë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì—°ê²°ë˜ê¸° ë•Œë¬¸ì´ë‹¤. IPì˜ êµ¬ì¡°, í—¤ë” í•„ë“œ, ê·¸ë¦¬ê³  í¬ì›Œë”© ë©”ì»¤ë‹ˆì¦˜ì„ ê¹Šì´ ìˆê²Œ ì‚´í´ë³´ì.*

-----

## **IPì˜ ì—­í• ê³¼ ìœ„ì¹˜**

### The Waist of the Hourglass

ğŸ“š**<span style="color: #008000">IP (Internet Protocol)</span>**: Network Layerì—ì„œ ë™ì‘í•˜ëŠ” í”„ë¡œí† ì½œë¡œ, ë‹¤ì–‘í•œ ë§í¬ ê³„ì¸µ ê¸°ìˆ ë“¤ê³¼ ìƒìœ„ ì „ì†¡ ê³„ì¸µ í”„ë¡œí† ì½œë“¤ì„ ì—°ê²°í•˜ëŠ” í•µì‹¬ í”„ë¡œí† ì½œ

**ëª¨ë˜ì‹œê³„ ëª¨ë¸:**

```
                    Application Layer
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ HTTP  SMTP  RTP ...  â”‚  â† ë‹¤ì–‘í•œ ìƒìœ„ í”„ë¡œí† ì½œ
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   TCP      UDP       â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                      â”‚    IP     â”‚        â† í—ˆë¦¬ (Waist)!
                      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Ethernet  WiFi  PPP  â”‚  â† ë‹¤ì–‘í•œ í•˜ìœ„ ê¸°ìˆ 
                 â”‚ FDDI  ATM  Bluetooth â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    Physical Layer
```

**í•µì‹¬ íŠ¹ì§•:**
* âœ… **One network layer protocol**: ëª¨ë“  ì¸í„°ë„· ì—°ê²° ì¥ì¹˜ì— êµ¬í˜„ë˜ì–´ì•¼ í•¨
* âœ… **í˜¸í™˜ì„± í•´ê²°**: ì„œë¡œ ë‹¤ë¥¸ ë§í¬ ê³„ì¸µ ê¸°ìˆ ë“¤ ê°„ì˜ í˜¸í™˜ì„± ë¬¸ì œ í•´ê²°
* âœ… **IP Forwarding**: íŒ¨í‚·ì„ ëª©ì ì§€ê¹Œì§€ ì „ë‹¬í•˜ëŠ” í•µì‹¬ ê¸°ëŠ¥

### IPê°€ êµ¬í˜„ë˜ëŠ” ìœ„ì¹˜

```
Host A           Router 1         Router 2         Host B
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App    â”‚    â”‚          â”‚    â”‚          â”‚    â”‚   App    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   TCP    â”‚    â”‚          â”‚    â”‚          â”‚    â”‚   TCP    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    IP    â”‚â—„â”€â”€â–ºâ”‚    IP    â”‚â—„â”€â”€â–ºâ”‚    IP    â”‚â—„â”€â”€â–ºâ”‚    IP    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”¤    â”œâ”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data Linkâ”‚    â”‚DLâ”‚ DL â”‚DLâ”‚    â”‚DLâ”‚ DL â”‚DLâ”‚    â”‚Data Link â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”˜    â””â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¤‘ìš” í¬ì¸íŠ¸:**
* **IPëŠ” ë¼ìš°í„°ì™€ í˜¸ìŠ¤íŠ¸ ëª¨ë‘ì—ì„œ êµ¬í˜„ë˜ëŠ” ìµœìƒìœ„ í”„ë¡œí† ì½œ**
* Applicationê³¼ TCPëŠ” End-to-End (í˜¸ìŠ¤íŠ¸ì—ì„œë§Œ)
* IPëŠ” hop-by-hop (ëª¨ë“  ë¼ìš°í„°ì—ì„œ ì²˜ë¦¬)

-----

## **IP Service íŠ¹ì„±**

### IPì˜ 3ê°€ì§€ í•µì‹¬ íŠ¹ì„±

**1ï¸âƒ£ Connectionless (ë¹„ì—°ê²°ì„±)**
* ğŸ“Œ **ë¬¼ë¦¬ì ì¸ ì—°ê²°ì´ ì—†ë‹¤ëŠ” ì˜ë¯¸ê°€ ì•„ë‹˜** â†’ ê´€ë¦¬ ì—†ìŒ
* ê° íŒ¨í‚·ì´ ë…ë¦½ì ìœ¼ë¡œ ì²˜ë¦¬ë¨
* ìˆœì°¨ì  ì „ë‹¬ ë³´ì¥ ì—†ìŒ (No sequential delivery)

**2ï¸âƒ£ Unreliable (ë¹„ì‹ ë¢°ì„±)**
* íŒ¨í‚· ì†ì‹¤ ê°€ëŠ¥ (Lost packets)
* ì¤‘ë³µ íŒ¨í‚· ë°œìƒ ê°€ëŠ¥
* ìˆœì„œ ë’¤ë°”ë€œ ê°€ëŠ¥ (Out-of-sequence delivery)

**3ï¸âƒ£ Best Effort (ìµœì„  ë…¸ë ¥)**
* Throughput ë³´ì¥ ì—†ìŒ
* Delay ë³´ì¥ ì—†ìŒ
* QoS ë³´ì¥ ì—†ìŒ

**ê²°ê³¼:**

```
Consequences:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ íŒ¨í‚·ì´ ìˆœì„œëŒ€ë¡œ ë„ì°©í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ             â”‚
â”‚ âŒ íŒ¨í‚·ì´ ì†ì‹¤ë˜ê±°ë‚˜ ì¤‘ë³µë  ìˆ˜ ìˆìŒ                 â”‚
â”‚ âœ… ìƒìœ„ ê³„ì¸µ í”„ë¡œí† ì½œ(TCP)ì´ ì´ë¥¼ ì²˜ë¦¬í•´ì•¼ í•¨       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

{:.prompt-info}
> **Why Best Effort?**: ë‹¨ìˆœì„±ê³¼ í™•ì¥ì„±ì„ ìœ„í•´ ë³µì¡í•œ ë³´ì¥ ê¸°ëŠ¥ì€ ìƒìœ„ ê³„ì¸µ(TCP)ì— ìœ„ì„

### IPê°€ ì§€ì›í•˜ëŠ” í†µì‹  ë°©ì‹

ğŸ“š**<span style="color: #008000">IP Multicast</span>**: í•˜ë‚˜ì˜ íŒ¨í‚·ì„ ì—¬ëŸ¬ ìˆ˜ì‹ ìì—ê²Œ ì „ì†¡í•˜ëŠ” íš¨ìœ¨ì ì¸ ë°©ë²• (IGMP, multicast routing í”„ë¡œí† ì½œ í•„ìš”)

**3ê°€ì§€ í†µì‹  ë°©ì‹:**

```
1. Unicast (1:1)          2. Broadcast (1:all)       3. Multicast (1:some)
     â—  â†’  â—                    â—  â†’  â—â—â—                  â—  â†’  â—â—
                                      â—â—â—                        â—
```

| ë°©ì‹          | ì„¤ëª…                    | ì˜ˆì‹œ               |
| :------------ | :---------------------- | :----------------- |
| **Unicast**   | 1:1 í†µì‹                 | ì¼ë°˜ ì›¹ ë¸Œë¼ìš°ì§•   |
| **Broadcast** | 1:ëª¨ë‘ í†µì‹              | ARP request        |
| **Multicast** | 1:ê·¸ë£¹ í†µì‹  (ì„ íƒì )    | IPTV, í™”ìƒíšŒì˜     |

-----

## **IP Header êµ¬ì¡°**

### IP Header ì „ì²´ êµ¬ì¡°

```
bit # 0       7 8      15 16     23 24                            31
â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚versionâ”‚headerâ”‚   DS   â”‚   ECN   â”‚    total length (in bytes)   â”‚
â”‚  (4) â”‚lengthâ”‚   (6)  â”‚   (2)   â”‚           (16 bits)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”¼â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       Identification          â”‚0 â”‚DF â”‚MF â”‚  Fragment offset    â”‚
â”‚          (16 bits)            â”‚  â”‚ (1)â”‚(1)â”‚    (13 bits)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚time-to-live   â”‚   protocol    â”‚    header checksum              â”‚
â”‚   (TTL)       â”‚    (8 bits)   â”‚      (16 bits)                  â”‚
â”‚  (8 bits)     â”‚               â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  source IP address (32 bits)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                destination IP address (32 bits)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  options (0 to 40 bytes)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       payload                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        4 bytes
```

**í¬ê¸°:**
* **ìµœì†Œ í—¤ë” í¬ê¸°**: 20 bytes (ì˜µì…˜ ì—†ì„ ë•Œ)
* **ìµœëŒ€ í—¤ë” í¬ê¸°**: 60 bytes (ì˜µì…˜ 40 bytes í¬í•¨)
* **ìµœëŒ€ Total Length**: 2^16 bytes = 65,536 bytes

-----

## **IP Header í•„ë“œ ìƒì„¸**

### Version (4 bits)

**ì—­í• **: IP í”„ë¡œí† ì½œ ë²„ì „ ì‹ë³„

* **IPv4**: ê°’ = `4` (ëŒ€ë¶€ë¶„)
* **IPv6**: ê°’ = `6`

### Header Length (4 bits)

ğŸ“š**<span style="color: #008000">Header Length (IHL)</span>**: IP í—¤ë”ì˜ ê¸¸ì´ë¥¼ 4-byte ë‹¨ìœ„ë¡œ í‘œí˜„

**ê³„ì‚° ë°©ë²•:**
```
í—¤ë” ê¸¸ì´ = Header Length Ã— 4 bytes

ì˜ˆì‹œ:
  Header Length = 5 â†’ 5 Ã— 4 = 20 bytes (ì˜µì…˜ ì—†ìŒ)
  Header Length = 15 â†’ 15 Ã— 4 = 60 bytes (ìµœëŒ€)
```

### DS/ECN Field (1 byte = 8 bits)

**ê³¼ê±°: Type of Service (TOS) í•„ë“œ**
**í˜„ì¬: DS (6 bits) + ECN (2 bits)**

**Differentiated Service (DS) - 6 bits:**
* ì„œë¹„ìŠ¤ ë ˆë²¨ ì§€ì • (í˜„ì¬ ì¸í„°ë„·ì—ì„œëŠ” ë¯¸ì§€ì›)
* QoS ì°¨ë³„í™” ìš©ë„

**Explicit Congestion Notification (ECN) - 2 bits:**
* TCPì˜ í˜¼ì¡ ì œì–´ë¥¼ ìœ„í•œ í”¼ë“œë°± ë©”ì»¤ë‹ˆì¦˜
* ë¼ìš°í„°ê°€ í˜¼ì¡ ìƒíƒœë¥¼ íŒ¨í‚·ì— í‘œì‹œ

### Total Length (16 bits)

**ì—­í• **: ì „ì²´ íŒ¨í‚· í¬ê¸° (í—¤ë” + í˜ì´ë¡œë“œ)

```
Total Length = IP Header + IP Payload
ìµœì†Œ: 20 bytes (í—¤ë”ë§Œ)
ìµœëŒ€: 65,535 bytes (2^16 - 1)

âš ï¸ ì£¼ì˜: í•˜ìœ„ ë§í¬ ê³„ì¸µì˜ MTUê°€ ì´ë³´ë‹¤ ì‘ì„ ìˆ˜ ìˆìŒ!
```

-----

## **Fragmentation ê´€ë ¨ í•„ë“œ**

### MTU (Maximum Transmission Unit)

ğŸ“š**<span style="color: #008000">MTU</span>**: ë°ì´í„° ë§í¬ í”„ë¡œí† ì½œì´ ì „ì†¡í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ IP íŒ¨í‚· í¬ê¸°

**ì£¼ìš” MTU ê°’:**

| ë§í¬ íƒ€ì…   | MTU (bytes) |
| :---------- | :---------- |
| **Ethernet**| 1,500       |
| **802.3**   | 1,492       |
| **802.5**   | 4,464       |
| **FDDI**    | 4,352       |
| **ATM AAL5**| 9,180       |
| **PPP**     | negotiated  |

**ë¬¸ì œ ìƒí™©:**

```
Host A                 Router              Host B
  â”‚                      â”‚                    â”‚
  â”‚  4,000 byte packet   â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                    â”‚
         FDDI MTU=4352   â”‚  Ethernet MTU=1500 â”‚
                         â”‚                    â”‚
                    Fragmentation í•„ìš”!
```

### Fragmentation (ë‹¨í¸í™”)

**Fragmentationì´ ë°œìƒí•˜ëŠ” ê²½ìš°:**
* IP datagram í¬ê¸° > ë§í¬ì˜ MTU
* ë¼ìš°í„°ê°€ íŒ¨í‚·ì„ ì—¬ëŸ¬ ì¡°ê°(fragment)ìœ¼ë¡œ ë¶„í• 

**Fragmentation ì¥ì†Œ:**
* Sender (ì†¡ì‹ ì)
* Intermediate routers (ì¤‘ê°„ ë¼ìš°í„°)
* ë™ì¼í•œ datagramì´ ì—¬ëŸ¬ ë²ˆ fragmentationë  ìˆ˜ ìˆìŒ

### Reassembly (ì¬ì¡°ë¦½)

**ì–´ë””ì„œ ì¬ì¡°ë¦½í•˜ëŠ”ê°€?**

**âŒ Option 1: ì¤‘ê°„ ë¼ìš°í„°ì—ì„œ ì¬ì¡°ë¦½?**

```
Host A  â†’  R1  â†’  R2  â†’  Host B
       Fragment  Reassemble?
```

* **ë¬¸ì œ**: Fragmentë“¤ì´ ì„œë¡œ ë‹¤ë¥¸ ê²½ë¡œë¡œ ê°ˆ ìˆ˜ ìˆìŒ!

**âœ… Option 2: ìµœì¢… ëª©ì ì§€(End-host)ì—ì„œ ì¬ì¡°ë¦½**

```
Host A  â†’  R1  â”¬â†’  R3  â”
              Fragment  â””â†’  Host B (Reassemble!)
           R2  â”˜
```

* **ì •ë‹µ**: ëª¨ë“  fragmentëŠ” **ìµœì¢… ìˆ˜ì‹ ì(Destination host)**ì—ì„œ ì¬ì¡°ë¦½
* Fragmentsê°€ ì„œë¡œ ë‹¤ë¥¸ ê²½ë¡œë¥¼ ê±°ì¹  ìˆ˜ ìˆê¸° ë•Œë¬¸!

### Fragmentation ê´€ë ¨ í•„ë“œ

**Identification (16 bits):**
* ë™ì¼í•œ datagramì˜ ëª¨ë“  fragmentëŠ” **ë™ì¼í•œ ID**
* ì†¡ì‹ ìê°€ datagram ì „ì†¡ ì‹œë§ˆë‹¤ ì¦ê°€ì‹œí‚´

**Flags (3 bits):**

| ë¹„íŠ¸ | ì´ë¦„ | ì˜ë¯¸                                    |
| :--- | :--- | :-------------------------------------- |
| 0    | -    | í•­ìƒ 0 (ì˜ˆì•½)                           |
| DF   | Don't Fragment | 1ì´ë©´ ë‹¨í¸í™” ê¸ˆì§€, íŒ¨í‚· drop í›„ ICMP ì „ì†¡ |
| MF   | More Fragments | 1ì´ë©´ ë’¤ì— fragmentê°€ ë” ìˆìŒ           |

**Fragment Offset (13 bits):**
* í˜„ì¬ fragmentì˜ í˜ì´ë¡œë“œê°€ ì›ë³¸ datagramì—ì„œ ì°¨ì§€í•˜ëŠ” ìœ„ì¹˜
* **8-byte ë‹¨ìœ„ë¡œ í‘œí˜„** (ì‹¤ì œ offset = ê°’ Ã— 8)

### Fragmentation ì˜ˆì‹œ

**Original Packet: 4,000 bytes**

```
Version: 4          Header Length: 5        Type of Service: 0
Total Length: 4000
Identification: 56273                    R/D/M: 0/0/0
Fragment Offset: 0
TTL: 127            Protocol: 6 (TCP)     Checksum: 44019
Source: 1.2.3.4
Destination: 3.4.5.6
(3980 bytes payload)
```

**MTU = 1,500 bytesì¼ ë•Œ Fragmentation:**

```
ì›ë³¸:
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20 â”‚           3980 bytes                 â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     4000 bytes

ë¶„í•  í›„:
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20 â”‚  1480 bytes   â”‚  â”‚ 20 â”‚ 1200     â”‚  â”‚ 20 â”‚ 1300     â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     1500 bytes              1220 bytes         1320 bytes
```

**Fragment 1:**
```
Total Length: 1500
Identification: 56273
R/D/MF: 0/0/1  â† MF=1 (ë” ìˆìŒ!)
Fragment Offset: 0  (0 Ã— 8 = 0)
```

**Fragment 2:**
```
Total Length: 1220
Identification: 56273
R/D/MF: 0/0/1  â† MF=1 (ë” ìˆìŒ!)
Fragment Offset: 185  (185 Ã— 8 = 1480)
```

**Fragment 3 (ë§ˆì§€ë§‰):**
```
Total Length: 1320
Identification: 56273
R/D/MF: 0/0/0  â† MF=0 (ë§ˆì§€ë§‰!)
Fragment Offset: 335  (335 Ã— 8 = 2680)
```

-----

## **TTL (Time-to-Live)**

### TTLì˜ ì—­í• 

ğŸ“š**<span style="color: #008000">TTL (Time-to-Live)</span>**: íŒ¨í‚·ì´ ë¬´í•œ ë£¨í”„ë¥¼ ë„ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•œ í™‰ ì¹´ìš´í„°

**ë¬¸ì œ ìƒí™©: Forwarding Loop**

```
     R1 â‡„ R2
      â†“   â†‘
      R3

íŒ¨í‚·ì´ ë¬´í•œì • ìˆœí™˜! â†’ ëª¨ë“  ëŒ€ì—­í­ ì†Œëª¨!
```

**TTL ë™ì‘ ë°©ì‹:**

1. **Sender**: TTL ê°’ ì„¤ì • (ì˜ˆ: 64)
2. **ê° ë¼ìš°í„°**: TTL ê°’ì„ 1ì”© ê°ì†Œ
3. **TTL = 0**: Datagram drop + "Time Exceeded" ICMP ë©”ì‹œì§€ ì†¡ì‹ 

**Ping ì¶œë ¥ ì˜ˆì‹œ:**

```bash
C:\Users\ì‚¬ìš©ì>ping www.unipi.it

131.114.21.42ì˜ ì‘ë‹µ: ë°”ì´íŠ¸=32 ì‹œê°„=308ms TTL=39
131.114.21.42ì˜ ì‘ë‹µ: ë°”ì´íŠ¸=32 ì‹œê°„=307ms TTL=39
131.114.21.42ì˜ ì‘ë‹µ: ë°”ì´íŠ¸=32 ì‹œê°„=306ms TTL=39
```

**TTL ê°’ì˜ ì˜ë¯¸:**
* ì´ˆê¸°ê°’ 64ë¡œ ì‹œì‘í–ˆë‹¤ë©´ â†’ 25 hops (64 - 39 = 25)
* tracerouteì˜ ê¸°ë°˜ì´ ë˜ëŠ” ë©”ì»¤ë‹ˆì¦˜!

-----

## **Protocol Field**

### Protocol (8 bits)

ğŸ“š**<span style="color: #008000">Protocol Field</span>**: ìƒìœ„ ê³„ì¸µ í”„ë¡œí† ì½œì„ ì‹ë³„í•˜ì—¬ ìˆ˜ì‹  í˜¸ìŠ¤íŠ¸ê°€ ì˜¬ë°”ë¥´ê²Œ ì—­ë‹¤ì¤‘í™”(demultiplexing)í•  ìˆ˜ ìˆë„ë¡ í•¨

**ì£¼ìš” Protocol ë²ˆí˜¸:**

| ë²ˆí˜¸ | í”„ë¡œí† ì½œ           | ì„¤ëª…                     |
| :--- | :----------------- | :----------------------- |
| 1    | **ICMP**           | Internet Control Message |
| 2    | **IGMP**           | Internet Group Management|
| 4    | **IP-in-IP**       | IP encapsulation         |
| 6    | **TCP**            | Transmission Control     |
| 17   | **UDP**            | User Datagram            |

**Demultiplexing ì˜ˆì‹œ:**

```
ìˆ˜ì‹  íŒ¨í‚·:
  Protocol = 6 (TCP)
     â†“
  IP ê³„ì¸µì´ TCP ëª¨ë“ˆë¡œ ì „ë‹¬
     â†“
  TCP í—¤ë” íŒŒì‹± ì‹œì‘
```

-----

## **Header Checksum**

### Checksum (16 bits)

ğŸ“š**<span style="color: #008000">Header Checksum</span>**: IP í—¤ë”ì˜ ë¬´ê²°ì„±ì„ ê²€ì¦í•˜ê¸° ìœ„í•œ ì²´í¬ì„¬ (payloadëŠ” ê²€ì‚¬ ì•ˆ í•¨!)

**ê³„ì‚° ë°©ë²•: One's Complement Sum**

```
Step 1: 16-bit wordsë¡œ ë¶„í• 
  1011 0000 0101 1111  +
  1110 1100 0101 1100  =
 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 1 1001 1100 1011 1011  â† Carry ë°œìƒ

Step 2: Carryë¥¼ ë‹¤ì‹œ ë”í•¨
  1001 1100 1011 1011  +
  0000 0000 0000 0001  =
 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1001 1100 1011 1100

Step 3: One's Complement (ë¹„íŠ¸ ë°˜ì „)
  0110 0011 0100 0011  â† Checksum!
```

**ë§¤ ë¼ìš°í„°ì—ì„œ ì¬ê³„ì‚°:**
* TTLì´ ë³€ê²½ë˜ë¯€ë¡œ checksumë„ ë§¤ë²ˆ ì¬ê³„ì‚° í•„ìš”
* Checksum ë¶ˆì¼ì¹˜ â†’ íŒ¨í‚· íê¸°

**Checksum Offloading:**
* ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ NIC (Network Interface Card)ì—ì„œ ê³„ì‚°
* OS ë¶€ë‹´ ê°ì†Œ

-----

## **IP Options**

### Options (0~40 bytes)

ğŸ“š**<span style="color: #008000">IP Options</span>**: ì„ íƒì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ í™•ì¥ ê¸°ëŠ¥ (TLV í˜•ì‹)

**TLV (Type-Length-Value) êµ¬ì¡°:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type â”‚ Length â”‚     Value      â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  1 byte  1 byte   Variable
```

**ì£¼ìš” Optionë“¤:**

| Type | ì´ë¦„             | ì„¤ëª…                                          | ì‚¬ìš© ë¹ˆë„  |
| :--- | :--------------- | :-------------------------------------------- | :--------- |
| 0    | End of List      | ì˜µì…˜ ëª©ë¡ ë                                  | If required|
| 1    | No Operation     | Padding ìš©ë„                                  | If required|
| 7    | **Record Route** | ê° ë¼ìš°í„°ê°€ ìì‹ ì˜ IPë¥¼ í—¤ë”ì— ì¶”ê°€           | Rare       |
| 68   | **Timestamp**    | ê° ë¼ìš°í„°ê°€ IP + ì‹œê°„ ì¶”ê°€                     | Rare       |
| 131  | **Loose Source Routing** | ë°˜ë“œì‹œ ê±°ì³ì•¼ í•  ë¼ìš°í„° ëª©ë¡ (ì¤‘ê°„ì— ë‹¤ë¥¸ ë¼ìš°í„° ê°€ëŠ¥) | Rare, filtered |
| 137  | **Strict Source Routing**| ì˜¤ì§ ëª…ì‹œëœ ë¼ìš°í„°ë“¤ë§Œ ê±°ì³ì•¼ í•¨               | Rare, filtered |
| 148  | **Router Alert** | ë¼ìš°í„°ê°€ íŒ¨í‚· ë‚´ìš©ì„ ê²€ì‚¬í•´ì•¼ í•¨               | Occasional |

### Router Alert Option

**íŠ¹ì§•:**
* ë³´í†µ ë¼ìš°í„°ëŠ” íŒ¨í‚·ì„ í¬ì›Œë”©ë§Œ í•¨
* **Router Alert**: ë¼ìš°í„°ê°€ íŒ¨í‚· ë‚´ìš©ì„ ê²€ì‚¬í•˜ê³  íŠ¹ë³„í•œ ì²˜ë¦¬ ìˆ˜í–‰

**ì‚¬ìš© ì˜ˆì‹œ: IGMP (Internet Group Management Protocol)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Options: (4 bytes), Router Alert               â”‚
â”‚   Router Alert (4 bytes): Router shall examine  â”‚
â”‚     Type: 148                                   â”‚
â”‚     Length: 4                                   â”‚
â”‚     Router Alert (20)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Internet Group Management Protocol              â”‚
â”‚   [IGMP Version: 2]                             â”‚
â”‚   Type: Membership Query (0x11)                 â”‚
â”‚   Max Response Time: 10.0 sec (0x64)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë¼ìš°í„°ì—ê²Œ ìƒíƒœ ì •ë³´(state)ê°€ ê¸°ë¡ë˜ì–´ì•¼ í•  ë•Œ RA ì˜µì…˜ ì‚¬ìš©**
â†’ ì•…ì˜ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥ (ê³µê²© ë²¡í„°)

### Source Routing

**Loose Source Routing (Type 131):**

```
Wireshark ì˜ˆì‹œ:
Source Route: 151.101.229.67 <- (next)
Destination: 151.101.229.67

Time to live: 1
Current Route: 163.152.1.1
```

* íŒ¨í‚·ì´ íŠ¹ì • ë¼ìš°í„°ë“¤ì„ **ë°˜ë“œì‹œ ê±°ì³ì•¼ í•¨**
* ì¤‘ê°„ì— ë‹¤ë¥¸ ë¼ìš°í„°ë„ ê±°ì¹  ìˆ˜ ìˆìŒ

**ë³´ì•ˆ ì´ìŠˆ:**
* ëŒ€ë¶€ë¶„ì˜ ë¼ìš°í„°ëŠ” **source routing ì˜µì…˜ì„ drop**í•¨
* í•´í‚¹ì— ì•…ìš©ë  ìˆ˜ ìˆê¸° ë•Œë¬¸

### Padding

**ì—­í• **: IP í—¤ë”ê°€ **4-byte ê²½ê³„**ì—ì„œ ëë‚˜ë„ë¡ ë³´ì¥

```
Options: 11 bytes
Padding: 1 byte ì¶”ê°€
Total Header: 20 + 12 = 32 bytes (4ì˜ ë°°ìˆ˜ âœ…)
```

-----

## **IP ê³µê²© ìœ í˜•**

### Attacks Involving IP

**1. IP í—¤ë” í•„ë“œ ì¡°ì‘:**
* Bad header length
* Wrong version number
* ëª©í‘œ: ë¼ìš°í„° í¬ë˜ì‹œ ë˜ëŠ” ì„±ëŠ¥ ì €í•˜

**2. Option ì•…ìš©:**
* Specialized code (fragment reassembly) ë²„ê·¸ ìµìŠ¤í”Œë¡œì‡
* Router Alert ë‚¨ìš©

**3. IP Spoofing:**

ğŸ“š**<span style="color: #008000">IP Spoofing</span>**: ì†¡ì‹ ìê°€ Source IP ì£¼ì†Œë¥¼ ìœ„ì¡°í•˜ì—¬ ê³µê²©

**ë°©ì–´: Ingress Filtering**
```
ISP ê²½ê³„ ë¼ìš°í„°ì—ì„œ:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ If (source IP prefix !=    â”‚
  â”‚     expected prefix)       â”‚
  â”‚   â†’ DROP packet!           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

* ë¼ìš°í„°ê°€ ë“¤ì–´ì˜¤ëŠ” íŒ¨í‚·ì˜ **Source IP prefix ê²€ì¦**
* ì˜ˆìƒë˜ëŠ” prefixê°€ ì•„ë‹ˆë©´ íê¸°

-----

## **Forwarding (í¬ì›Œë”©)**

### Forwardingì˜ ê°œë…

ğŸ“š**<span style="color: #008000">Forwarding</span>**: ë¼ìš°í„°ê°€ ìˆ˜ì‹ í•œ íŒ¨í‚·ì„ ì ì ˆí•œ ì¶œë ¥ ì¸í„°í˜ì´ìŠ¤ë¡œ ì „ë‹¬í•˜ëŠ” ê³¼ì •

**ë¼ìš°í„°ì˜ ì£¼ìš” ê¸°ëŠ¥:**
1. **Routing**: ê²½ë¡œ ê²°ì • (Routing Table ìƒì„±)
2. **Forwarding**: ì‹¤ì œ íŒ¨í‚· ì „ë‹¬ (Forwarding Table ì‚¬ìš©)

### Routing Table êµ¬ì¡°

**IPv4 Routing Table:**

```
í™œì„± ê²½ë¡œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ë„¤íŠ¸ì›Œí¬ ëŒ€ìƒ â”‚ë„¤íŠ¸ì›Œí¬ë§ˆìŠ¤í¬â”‚ ê²Œì´íŠ¸ì›¨ì´  â”‚ ì¸í„°í˜ì´ìŠ¤   â”‚ë©”íŠ¸ë¦­  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  0.0.0.0     â”‚  0.0.0.0     â”‚ 192.168.0.1 â”‚ 192.168.0.33 â”‚   50   â”‚
â”‚ 127.0.0.0    â”‚ 255.0.0.0    â”‚  ì—°ê²°ë¨     â”‚ 127.0.0.1    â”‚  331   â”‚
â”‚ 127.0.0.1    â”‚255.255.255.255â”‚ ì—°ê²°ë¨     â”‚ 127.0.0.1    â”‚  331   â”‚
â”‚127.255.255.255â”‚255.255.255.255â”‚ì—°ê²°ë¨     â”‚ 127.0.0.1    â”‚  331   â”‚
â”‚ 192.168.0.0  â”‚255.255.255.0 â”‚  ì—°ê²°ë¨     â”‚192.168.0.33  â”‚  306   â”‚
â”‚192.168.0.33  â”‚255.255.255.255â”‚ ì—°ê²°ë¨     â”‚192.168.0.33  â”‚  306   â”‚
â”‚192.168.0.255 â”‚255.255.255.255â”‚ ì—°ê²°ë¨     â”‚192.168.0.33  â”‚  306   â”‚
â”‚ 224.0.0.0    â”‚ 240.0.0.0    â”‚  ì—°ê²°ë¨     â”‚ 127.0.0.1    â”‚  331   â”‚
â”‚ 224.0.0.0    â”‚ 240.0.0.0    â”‚  ì—°ê²°ë¨     â”‚192.168.0.33  â”‚  306   â”‚
â”‚255.255.255.255â”‚255.255.255.255â”‚ì—°ê²°ë¨     â”‚ 127.0.0.1    â”‚  331   â”‚
â”‚255.255.255.255â”‚255.255.255.255â”‚ì—°ê²°ë¨     â”‚192.168.0.33  â”‚  306   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**êµ¬ì„± ìš”ì†Œ:**

1. **Destination network prefix** (ë„¤íŠ¸ì›Œí¬ ëŒ€ìƒ)
2. **Network mask** (ë„¤íŠ¸ì›Œí¬ ë§ˆìŠ¤í¬)
3. **Gateway** (ê²Œì´íŠ¸ì›¨ì´): ë‹¤ìŒ í™‰ ë¼ìš°í„°ì˜ IP ì£¼ì†Œ (ë˜ëŠ” "ì—°ê²°ë¨")
4. **Interface** (ì¸í„°í˜ì´ìŠ¤): íŒ¨í‚·ì„ ë‚´ë³´ë‚´ëŠ” IF
5. **Metric** (ë©”íŠ¸ë¦­): ì—”íŠ¸ë¦¬ ìš°ì„ ìˆœìœ„ (ë‚®ì„ìˆ˜ë¡ ìš°ì„ )

### Default Router vs Core Router

**Default Router (Edge Router):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Default Entry ìˆìŒ        â”‚
â”‚  0.0.0.0/0 â†’ Gateway       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   ë§¤ì¹­ ì•ˆë˜ë©´?
       â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
   â”‚Internetâ”‚
   â”‚ë‚´ë¶€ë¡œ  â”‚
   â”‚forward â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

* **Default entry (0.0.0.0/0)** ì¡´ì¬
* ì•Œì§€ ëª»í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ ì¸í„°ë„·ìœ¼ë¡œ ì „ë‹¬

**Core Router (Backbone Router):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  No Default Entry!         â”‚
â”‚  ì™„ì „í•œ Routing Table      â”‚
â”‚  (~800,000 entries)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   ë§¤ì¹­ ì•ˆë˜ë©´?
       â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
   â”‚ DROP! â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

* Default entry **ì—†ìŒ**
* ì „ ì„¸ê³„ ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ì •ë³´ ë³´ìœ  (~80ë§Œ ê°œ ì—”íŠ¸ë¦¬)
* ë§¤ì¹­ ì•ˆ ë˜ë©´ â†’ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì£¼ì†Œ!

### ARP Cache

**ARP Cacheì˜ ì—­í• :**
* IP ì£¼ì†Œ â†’ MAC ì£¼ì†Œ ë§¤í•‘ ì •ë³´ ì €ì¥
* Forwarding ì‹œ Next-hopì˜ MAC ì£¼ì†Œ ì¡°íšŒ

```bash
C:\Users\ì‚¬ìš©ì>arp -a

ì¸í„°í˜ì´ìŠ¤: 172.30.1.59 --- 0x14
  ì¸í„°ë„· ì£¼ì†Œ       ë¬¼ë¦¬ì  ì£¼ì†Œ           ìœ í˜•
  172.30.1.37     44-cb-8b-e4-01-64     ë™ì 
  172.30.1.43     48-e2-44-27-c7-21     ë™ì 
  172.30.1.128    90-f8-91-89-ba-6a     ë™ì 
  172.30.1.254    00-07-89-82-0d-aa     ë™ì 
  172.30.1.255    ff-ff-ff-ff-ff-ff     ì •ì 
  224.0.0.2       01-00-5e-00-00-02     ì •ì 
  ...
```

### Routing Table Update

**ë¼ìš°íŒ… í…Œì´ë¸” ê°±ì‹  ë°©ë²•:**

1. **Routing Protocol** (ìë™):
   * RIP, OSPF, BGP ë“±
   * ë™ì ìœ¼ë¡œ ê²½ë¡œ í•™ìŠµ

2. **OS** (ìë™):
   * ì¸í„°í˜ì´ìŠ¤ up/down ê°ì§€
   * ì§ì ‘ ì—°ê²°ëœ ë„¤íŠ¸ì›Œí¬ ì¶”ê°€/ì‚­ì œ

3. **Admin (ìˆ˜ë™)**:
   * Static route ì¶”ê°€
   * ê´€ë¦¬ìê°€ ì§ì ‘ ì„¤ì •

-----

## **Forwarding ì˜ˆì‹œ**

### ë„¤íŠ¸ì›Œí¬ êµ¬ì„±

```
                   166.140.21.23/24 (Ethernet)
                        â”‚
       166.140.21.49/28â”€â”¼â”€166.140.21.3/28
                        â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚        Router              â”‚
          â”‚                            â”‚
          â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
            â”‚ PPP                  â”‚ Ethernet
   166.140.21.50/28                â”‚
            â”‚                      â”‚
   166.140.21.67/28        166.140.21.0/28
            â”‚                      â”‚
        â”Œâ”€â”€â”€â–¼â”€â”€â”              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
        â”‚Routerâ”‚              â”‚ Hosts   â”‚
        â””â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   166.140.21.77/28
```

**Routing Table:**

| Destination      | Next hop       | Netmask       | Interface |
| :--------------- | :------------- | :------------ | :-------- |
| 166.140.21.0     |                |               | eth0      |
| 127.0.0.0        | 127.0.0.1      | 255.0.0.0     | lo0       |
| 166.140.21.50    |                |               | ppp0      |
|                  |                |               | ppp1      |
| 0.0.0.0          | 166.140.21.1   |               | eth1      |

**í¬ì›Œë”© ê²°ì •:**

```
íŒ¨í‚· ë„ì°©: Destination = 166.140.21.5

Step 1: Routing Table ì¡°íšŒ
  - 166.140.21.0 ë§¤ì¹˜! (eth0)

Step 2: ARP Cache ì¡°íšŒ
  - 166.140.21.5ì˜ MAC ì£¼ì†Œ?

Step 3: íŒ¨í‚· ì „ì†¡
  - Ethernet frameìœ¼ë¡œ ìº¡ìŠí™”
  - eth0 ì¸í„°í˜ì´ìŠ¤ë¡œ ì†¡ì¶œ
```

-----

## **ì •ë¦¬**

### IPì˜ í•µì‹¬ íŠ¹ì§• ìš”ì•½

| íŠ¹ì§•             | ì„¤ëª…                                    |
| :--------------- | :-------------------------------------- |
| **Connectionless**| íŒ¨í‚·ë§ˆë‹¤ ë…ë¦½ì  ì²˜ë¦¬                    |
| **Unreliable**   | ì†ì‹¤, ì¤‘ë³µ, ìˆœì„œ ë’¤ë°”ë€œ ê°€ëŠ¥            |
| **Best Effort**  | QoS ë³´ì¥ ì—†ìŒ                           |
| **Hourglass**    | ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ê¸°ìˆ ì˜ ê³µí†µ ì¸í„°í˜ì´ìŠ¤    |

### IP Headerì˜ ì¤‘ìš” í•„ë“œ

| í•„ë“œ                 | ì—­í•                            | í¬ê¸°     |
| :------------------- | :----------------------------- | :------- |
| **Version**          | IPv4 vs IPv6                   | 4 bits   |
| **Total Length**     | íŒ¨í‚· ì „ì²´ í¬ê¸°                 | 16 bits  |
| **Identification**   | Fragment ì‹ë³„                  | 16 bits  |
| **Flags & Offset**   | Fragmentation ì œì–´             | 16 bits  |
| **TTL**              | ë¬´í•œ ë£¨í”„ ë°©ì§€                 | 8 bits   |
| **Protocol**         | ìƒìœ„ í”„ë¡œí† ì½œ ì‹ë³„ (TCP/UDP)   | 8 bits   |
| **Checksum**         | í—¤ë” ë¬´ê²°ì„± ê²€ì¦               | 16 bits  |
| **Source/Dest IP**   | ì†¡ìˆ˜ì‹ ì ì£¼ì†Œ                  | 32 bits  |

{:.prompt-tip}
> **Forwardingì˜ í•µì‹¬**: Routing Tableì˜ Longest Prefix Matchingìœ¼ë¡œ Next-hop ê²°ì •! 


